/*! multiparty.min.js build:1.0.0, production. Copyright(c) 2014 Kensaku Komatsu <kensaku.komatsu@gmail.com> */(function(e){!function(t){function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function o(e){this._events={},this.newListener=!1,s.call(this,e)}function u(e,t,n,r){if(!n)return[];var i=[],s,o,a,f,l,c,h,p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if(typeof n._listeners=="function")return e&&e.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)e&&e.push(n._listeners[s]);return[n]}if(d==="*"||d==="**"||n[d]){if(d==="*"){for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(i=i.concat(u(e,t,n[a],r+1)));return i}if(d==="**"){h=r+1===p||r+2===p&&v==="*",h&&n._listeners&&(i=i.concat(u(e,t,n,p)));for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(a==="*"||a==="**"?(n[a]._listeners&&!h&&(i=i.concat(u(e,t,n[a],p))),i=i.concat(u(e,t,n[a],r))):a===v?i=i.concat(u(e,t,n[a],r+2)):i=i.concat(u(e,t,n[a],r)));return i}i=i.concat(u(e,t,n[d],r+1))}f=n["*"],f&&u(e,t,f,r+1),l=n["**"];if(l)if(r<p){l._listeners&&u(e,t,l,p);for(a in l)a!=="_listeners"&&l.hasOwnProperty(a)&&(a===v?u(e,t,l[a],r+2):a===d?u(e,t,l[a],r+1):(c={},c[a]=l[a],u(e,t,{"**":c},r+1)))}else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return i}function a(e,t){e=typeof e=="string"?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;i+1<s;i++)if(e[i]==="**"&&e[i+1]==="**")return;var o=this.listenerTree,u=e.shift();while(u){o[u]||(o[u]={}),o=o[u];if(e.length===0){if(!o._listeners)o._listeners=t;else if(typeof o._listeners=="function")o._listeners=[o._listeners,t];else if(n(o._listeners)){o._listeners.push(t);if(!o._listeners.warned){var a=r;typeof this._events.maxListeners!="undefined"&&(a=this._events.maxListeners),a>0&&o._listeners.length>a&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}return!0}u=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function i(){--t===0&&r.off(e,i),n.apply(this,arguments)}var r=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(e==="newListener"&&!this.newListener&&!this._events.newListener)return!1;if(this._all){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;r<t;r++)this.event=e,this._all[r].apply(this,n)}if(e==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o=typeof e=="string"?e.split(this.delimiter):e.slice();u.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if(typeof s=="function"){this.event=e;if(arguments.length===1)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];var a=s.slice();for(var r=0,t=a.length;r<t;r++)this.event=e,a[r].apply(this,n);return a.length>0||!!this._all}return!!this._all},o.prototype.on=function(e,t){if(typeof e=="function")return this.onAny(e),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||i.call(this),this.emit("newListener",e,t);if(this.wildcard)return a.call(this,e,t),this;if(!this._events[e])this._events[e]=t;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],t];else if(n(this._events[e])){this._events[e].push(t);if(!this._events[e].warned){var s=r;typeof this._events.maxListeners!="undefined"&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},o.prototype.onAny=function(e){if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s=typeof e=="string"?e.split(this.delimiter):e.slice();i=u.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var o=0;o<i.length;o++){var a=i[o];r=a._listeners;if(n(r)){var f=-1;for(var l=0,c=r.length;l<c;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){f=l;break}if(f<0)continue;return this.wildcard?a._listeners.splice(f,1):this._events[e].splice(f,1),r.length===0&&(this.wildcard?delete a._listeners:delete this._events[e]),this}if(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)this.wildcard?delete a._listeners:delete this._events[e]}return this},o.prototype.offAny=function(e){var t=0,n=0,r;if(e&&this._all&&this._all.length>0){r=this._all;for(t=0,n=r.length;t<n;t++)if(e===r[t])return r.splice(t,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(arguments.length===0)return!this._events||i.call(this),this;if(this.wildcard){var t=typeof e=="string"?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0);for(var r=0;r<n.length;r++){var s=n[r];s._listeners=null}}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r=typeof e=="string"?e.split(this.delimiter):e.slice();return u.call(this,t,r,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},typeof define=="function"&&define.amd?define(function(){return o}):typeof e=="object"?e.EventEmitter2=o:window.EventEmitter2=o}();var t={MD5:{int2hex8_Fx:function(e){return this.int2hex8(e[1]*65536+e[0])},update_Fx:function(e,t){var n=this.a_[0],r=this.a_[1],i=this.b_[0],s=this.b_[1],o=this.c_[0],u=this.c_[1],a=this.d_[0],f=this.d_[1],l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R;t==1?(l=e.charCodeAt(0)|e.charCodeAt(1)<<8,C=e.charCodeAt(2)|e.charCodeAt(3)<<8,c=e.charCodeAt(4)|e.charCodeAt(5)<<8,k=e.charCodeAt(6)|e.charCodeAt(7)<<8,h=e.charCodeAt(8)|e.charCodeAt(9)<<8,L=e.charCodeAt(10)|e.charCodeAt(11)<<8,p=e.charCodeAt(12)|e.charCodeAt(13)<<8,A=e.charCodeAt(14)|e.charCodeAt(15)<<8,d=e.charCodeAt(16)|e.charCodeAt(17)<<8,O=e.charCodeAt(18)|e.charCodeAt(19)<<8,v=e.charCodeAt(20)|e.charCodeAt(21)<<8,M=e.charCodeAt(22)|e.charCodeAt(23)<<8,m=e.charCodeAt(24)|e.charCodeAt(25)<<8,_=e.charCodeAt(26)|e.charCodeAt(27)<<8,g=e.charCodeAt(28)|e.charCodeAt(29)<<8,D=e.charCodeAt(30)|e.charCodeAt(31)<<8,y=e.charCodeAt(32)|e.charCodeAt(33)<<8,P=e.charCodeAt(34)|e.charCodeAt(35)<<8,b=e.charCodeAt(36)|e.charCodeAt(37)<<8,H=e.charCodeAt(38)|e.charCodeAt(39)<<8,w=e.charCodeAt(40)|e.charCodeAt(41)<<8,B=e.charCodeAt(42)|e.charCodeAt(43)<<8,E=e.charCodeAt(44)|e.charCodeAt(45)<<8,j=e.charCodeAt(46)|e.charCodeAt(47)<<8,S=e.charCodeAt(48)|e.charCodeAt(49)<<8,F=e.charCodeAt(50)|e.charCodeAt(51)<<8,x=e.charCodeAt(52)|e.charCodeAt(53)<<8,I=e.charCodeAt(54)|e.charCodeAt(55)<<8,T=e.charCodeAt(56)|e.charCodeAt(57)<<8,q=e.charCodeAt(58)|e.charCodeAt(59)<<8,N=e.charCodeAt(60)|e.charCodeAt(61)<<8,R=e.charCodeAt(62)|e.charCodeAt(63)<<8):(l=e.charCodeAt(0),C=e.charCodeAt(1),c=e.charCodeAt(2),k=e.charCodeAt(3),h=e.charCodeAt(4),L=e.charCodeAt(5),p=e.charCodeAt(6),A=e.charCodeAt(7),d=e.charCodeAt(8),O=e.charCodeAt(9),v=e.charCodeAt(10),M=e.charCodeAt(11),m=e.charCodeAt(12),_=e.charCodeAt(13),g=e.charCodeAt(14),D=e.charCodeAt(15),y=e.charCodeAt(16),P=e.charCodeAt(17),b=e.charCodeAt(18),H=e.charCodeAt(19),w=e.charCodeAt(20),B=e.charCodeAt(21),E=e.charCodeAt(22),j=e.charCodeAt(23),S=e.charCodeAt(24),F=e.charCodeAt(25),x=e.charCodeAt(26),I=e.charCodeAt(27),T=e.charCodeAt(28),q=e.charCodeAt(29),N=e.charCodeAt(30),R=e.charCodeAt(31));var U;n+=(i&o|~i&a)+l+42104,r+=(s&u|~s&f)+C+55146,r+=n>>16,n&=65535,r&=65535,U=r>>9|n<<7&65535,r=n>>9|r<<7&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&i|~n&o)+c+46934,f+=(r&s|~r&u)+k+59591,f+=a>>16,a&=65535,f&=65535,U=f>>4|a<<12&65535,f=a>>4|f<<12&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&n|~a&i)+h+28891,u+=(f&r|~f&s)+L+9248,u+=o>>16,o&=65535,u&=65535,U=o>>15|u<<1&65535,u=u>>15|o<<1&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&a|~o&n)+p+52974,s+=(u&f|~u&r)+A+49597,s+=i>>16,i&=65535,s&=65535,U=i>>10|s<<6&65535,s=s>>10|i<<6&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&o|~i&a)+d+4015,r+=(s&u|~s&f)+O+62844,r+=n>>16,n&=65535,r&=65535,U=r>>9|n<<7&65535,r=n>>9|r<<7&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&i|~n&o)+v+50730,f+=(r&s|~r&u)+M+18311,f+=a>>16,a&=65535,f&=65535,U=f>>4|a<<12&65535,f=a>>4|f<<12&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&n|~a&i)+m+17939,u+=(f&r|~f&s)+_+43056,u+=o>>16,o&=65535,u&=65535,U=o>>15|u<<1&65535,u=u>>15|o<<1&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&a|~o&n)+g+38145,s+=(u&f|~u&r)+D+64838,s+=i>>16,i&=65535,s&=65535,U=i>>10|s<<6&65535,s=s>>10|i<<6&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&o|~i&a)+y+39128,r+=(s&u|~s&f)+P+27008,r+=n>>16,n&=65535,r&=65535,U=r>>9|n<<7&65535,r=n>>9|r<<7&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&i|~n&o)+b+63407,f+=(r&s|~r&u)+H+35652,f+=a>>16,a&=65535,f&=65535,U=f>>4|a<<12&65535,f=a>>4|f<<12&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&n|~a&i)+w+23473,u+=(f&r|~f&s)+B+65535,u+=o>>16,o&=65535,u&=65535,U=o>>15|u<<1&65535,u=u>>15|o<<1&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&a|~o&n)+E+55230,s+=(u&f|~u&r)+j+35164,s+=i>>16,i&=65535,s&=65535,U=i>>10|s<<6&65535,s=s>>10|i<<6&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&o|~i&a)+S+4386,r+=(s&u|~s&f)+F+27536,r+=n>>16,n&=65535,r&=65535,U=r>>9|n<<7&65535,r=n>>9|r<<7&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&i|~n&o)+x+29075,f+=(r&s|~r&u)+I+64920,f+=a>>16,a&=65535,f&=65535,U=f>>4|a<<12&65535,f=a>>4|f<<12&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&n|~a&i)+T+17294,u+=(f&r|~f&s)+q+42617,u+=o>>16,o&=65535,u&=65535,U=o>>15|u<<1&65535,u=u>>15|o<<1&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&a|~o&n)+N+2081,s+=(u&f|~u&r)+R+18868,s+=i>>16,i&=65535,s&=65535,U=i>>10|s<<6&65535,s=s>>10|i<<6&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&a|o&~a)+c+9570,r+=(s&f|u&~f)+k+63006,r+=n>>16,n&=65535,r&=65535,U=r>>11|n<<5&65535,r=n>>11|r<<5&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&o|i&~o)+m+45888,f+=(r&u|s&~u)+_+49216,f+=a>>16,a&=65535,f&=65535,U=f>>7|a<<9&65535,f=a>>7|f<<9&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&i|n&~i)+E+23121,u+=(f&s|r&~s)+j+9822,u+=o>>16,o&=65535,u&=65535,U=u>>2|o<<14&65535,u=o>>2|u<<14&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&n|a&~n)+l+51114,s+=(u&r|f&~r)+C+59830,s+=i>>16,i&=65535,s&=65535,U=i>>12|s<<4&65535,s=s>>12|i<<4&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&a|o&~a)+v+4189,r+=(s&f|u&~f)+M+54831,r+=n>>16,n&=65535,r&=65535,U=r>>11|n<<5&65535,r=n>>11|r<<5&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&o|i&~o)+w+5203,f+=(r&u|s&~u)+B+580,f+=a>>16,a&=65535,f&=65535,U=f>>7|a<<9&65535,f=a>>7|f<<9&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&i|n&~i)+N+59009,u+=(f&s|r&~s)+R+55457,u+=o>>16,o&=65535,u&=65535,U=u>>2|o<<14&65535,u=o>>2|u<<14&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&n|a&~n)+d+64456,s+=(u&r|f&~r)+O+59347,s+=i>>16,i&=65535,s&=65535,U=i>>12|s<<4&65535,s=s>>12|i<<4&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&a|o&~a)+b+52710,r+=(s&f|u&~f)+H+8673,r+=n>>16,n&=65535,r&=65535,U=r>>11|n<<5&65535,r=n>>11|r<<5&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&o|i&~o)+T+2006,f+=(r&u|s&~u)+q+49975,f+=a>>16,a&=65535,f&=65535,U=f>>7|a<<9&65535,f=a>>7|f<<9&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&i|n&~i)+p+3463,u+=(f&s|r&~s)+A+62677,u+=o>>16,o&=65535,u&=65535,U=u>>2|o<<14&65535,u=o>>2|u<<14&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&n|a&~n)+y+5357,s+=(u&r|f&~r)+P+17754,s+=i>>16,i&=65535,s&=65535,U=i>>12|s<<4&65535,s=s>>12|i<<4&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i&a|o&~a)+x+59653,r+=(s&f|u&~f)+I+43491,r+=n>>16,n&=65535,r&=65535,U=r>>11|n<<5&65535,r=n>>11|r<<5&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n&o|i&~o)+h+41976,f+=(r&u|s&~u)+L+64751,f+=a>>16,a&=65535,f&=65535,U=f>>7|a<<9&65535,f=a>>7|f<<9&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a&i|n&~i)+g+729,u+=(f&s|r&~s)+D+26479,u+=o>>16,o&=65535,u&=65535,U=u>>2|o<<14&65535,u=o>>2|u<<14&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o&n|a&~n)+S+19594,s+=(u&r|f&~r)+F+36138,s+=i>>16,i&=65535,s&=65535,U=i>>12|s<<4&65535,s=s>>12|i<<4&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i^o^a)+v+14658,r+=(s^u^f)+M+65530,r+=n>>16,n&=65535,r&=65535,U=r>>12|n<<4&65535,r=n>>12|r<<4&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n^i^o)+y+63105,f+=(r^s^u)+P+34673,f+=a>>16,a&=65535,f&=65535,U=f>>5|a<<11&65535,f=a>>5|f<<11&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a^n^i)+E+24866,u+=(f^r^s)+j+28061,u+=o>>16,o&=65535,u&=65535,U=o>>16|u<<0&65535,u=u>>16|o<<0&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o^a^n)+T+14348,s+=(u^f^r)+q+64997,s+=i>>16,i&=65535,s&=65535,U=i>>9|s<<7&65535,s=s>>9|i<<7&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i^o^a)+c+59972,r+=(s^u^f)+k+42174,r+=n>>16,n&=65535,r&=65535,U=r>>12|n<<4&65535,r=n>>12|r<<4&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n^i^o)+d+53161,f+=(r^s^u)+O+19422,f+=a>>16,a&=65535,f&=65535,U=f>>5|a<<11&65535,f=a>>5|f<<11&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a^n^i)+g+19296,u+=(f^r^s)+D+63163,u+=o>>16,o&=65535,u&=65535,U=o>>16|u<<0&65535,u=u>>16|o<<0&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o^a^n)+w+48240,s+=(u^f^r)+B+48831,s+=i>>16,i&=65535,s&=65535,U=i>>9|s<<7&65535,s=s>>9|i<<7&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i^o^a)+x+32454,r+=(s^u^f)+I+10395,r+=n>>16,n&=65535,r&=65535,U=r>>12|n<<4&65535,r=n>>12|r<<4&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n^i^o)+l+10234,f+=(r^s^u)+C+60065,f+=a>>16,a&=65535,f&=65535,U=f>>5|a<<11&65535,f=a>>5|f<<11&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a^n^i)+p+12421,u+=(f^r^s)+A+54511,u+=o>>16,o&=65535,u&=65535,U=o>>16|u<<0&65535,u=u>>16|o<<0&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o^a^n)+m+7429,s+=(u^f^r)+_+1160,s+=i>>16,i&=65535,s&=65535,U=i>>9|s<<7&65535,s=s>>9|i<<7&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(i^o^a)+b+53305,r+=(s^u^f)+H+55764,r+=n>>16,n&=65535,r&=65535,U=r>>12|n<<4&65535,r=n>>12|r<<4&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(n^i^o)+S+39397,f+=(r^s^u)+F+59099,f+=a>>16,a&=65535,f&=65535,U=f>>5|a<<11&65535,f=a>>5|f<<11&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(a^n^i)+N+31992,u+=(f^r^s)+R+8098,u+=o>>16,o&=65535,u&=65535,U=o>>16|u<<0&65535,u=u>>16|o<<0&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(o^a^n)+h+22117,s+=(u^f^r)+L+50348,s+=i>>16,i&=65535,s&=65535,U=i>>9|s<<7&65535,s=s>>9|i<<7&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(o^(65535-a|i))+l+8772,r+=(u^(65535-f|s))+C+62505,r+=n>>16,n&=65535,r&=65535,U=r>>10|n<<6&65535,r=n>>10|r<<6&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(i^(65535-o|n))+g+65431,f+=(s^(65535-u|r))+D+17194,f+=a>>16,a&=65535,f&=65535,U=f>>6|a<<10&65535,f=a>>6|f<<10&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(n^(65535-i|a))+T+9127,u+=(r^(65535-s|f))+q+43924,u+=o>>16,o&=65535,u&=65535,U=u>>1|o<<15&65535,u=o>>1|u<<15&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(a^(65535-n|o))+v+41017,s+=(f^(65535-r|u))+M+64659,s+=i>>16,i&=65535,s&=65535,U=i>>11|s<<5&65535,s=s>>11|i<<5&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(o^(65535-a|i))+S+22979,r+=(u^(65535-f|s))+F+25947,r+=n>>16,n&=65535,r&=65535,U=r>>10|n<<6&65535,r=n>>10|r<<6&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(i^(65535-o|n))+p+52370,f+=(s^(65535-u|r))+A+36620,f+=a>>16,a&=65535,f&=65535,U=f>>6|a<<10&65535,f=a>>6|f<<10&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(n^(65535-i|a))+w+62589,u+=(r^(65535-s|f))+B+65519,u+=o>>16,o&=65535,u&=65535,U=u>>1|o<<15&65535,u=o>>1|u<<15&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(a^(65535-n|o))+c+24017,s+=(f^(65535-r|u))+k+34180,s+=i>>16,i&=65535,s&=65535,U=i>>11|s<<5&65535,s=s>>11|i<<5&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(o^(65535-a|i))+y+32335,r+=(u^(65535-f|s))+P+28584,r+=n>>16,n&=65535,r&=65535,U=r>>10|n<<6&65535,r=n>>10|r<<6&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(i^(65535-o|n))+N+59104,f+=(s^(65535-u|r))+R+65068,f+=a>>16,a&=65535,f&=65535,U=f>>6|a<<10&65535,f=a>>6|f<<10&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(n^(65535-i|a))+m+17172,u+=(r^(65535-s|f))+_+41729,u+=o>>16,o&=65535,u&=65535,U=u>>1|o<<15&65535,u=o>>1|u<<15&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(a^(65535-n|o))+x+4513,s+=(f^(65535-r|u))+I+19976,s+=i>>16,i&=65535,s&=65535,U=i>>11|s<<5&65535,s=s>>11|i<<5&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,n+=(o^(65535-a|i))+d+32386,r+=(u^(65535-f|s))+O+63315,r+=n>>16,n&=65535,r&=65535,U=r>>10|n<<6&65535,r=n>>10|r<<6&65535,n=U+i,r+=s,n>65535&&(n&=65535,r++),r&=65535,a+=(i^(65535-o|n))+E+62005,f+=(s^(65535-u|r))+j+48442,f+=a>>16,a&=65535,f&=65535,U=f>>6|a<<10&65535,f=a>>6|f<<10&65535,a=U+n,f+=r,a>65535&&(a&=65535,f++),f&=65535,o+=(n^(65535-i|a))+h+53947,u+=(r^(65535-s|f))+L+10967,u+=o>>16,o&=65535,u&=65535,U=u>>1|o<<15&65535,u=o>>1|u<<15&65535,o=U+a,u+=f,o>65535&&(o&=65535,u++),u&=65535,i+=(a^(65535-n|o))+b+54161,s+=(f^(65535-r|u))+H+60294,s+=i>>16,i&=65535,s&=65535,U=i>>11|s<<5&65535,s=s>>11|i<<5&65535,i=U+o,s+=u,i>65535&&(i&=65535,s++),s&=65535,U=this.a_[0]+=n,this.a_[1]+=r,U>65535&&(this.a_[0]-=65536,this.a_[1]++),this.a_[1]&=65535,U=this.b_[0]+=i,this.b_[1]+=s,U>65535&&(this.b_[0]-=65536,this.b_[1]++),this.b_[1]&=65535,U=this.c_[0]+=o,this.c_[1]+=u,U>65535&&(this.c_[0]-=65536,this.c_[1]++),this.c_[1]&=65535,U=this.d_[0]+=a,this.d_[1]+=f,U>65535&&(this.d_[0]-=65536,this.d_[1]++),this.d_[1]&=65535},int2hex8:function(e){var t,n,r="",i="0123456789abcdef";for(t=0;t<4;t++)n=e>>>t*8,r+=i.charAt(n>>4&15),r+=i.charAt(n&15);return r},update_std:function(e,t){var n=this.a_,r=this.b_,i=this.c_,s=this.d_,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;t==1?(o=e.charCodeAt(0)|e.charCodeAt(1)<<8|e.charCodeAt(2)<<16|e.charCodeAt(3)<<24,u=e.charCodeAt(4)|e.charCodeAt(5)<<8|e.charCodeAt(6)<<16|e.charCodeAt(7)<<24,a=e.charCodeAt(8)|e.charCodeAt(9)<<8|e.charCodeAt(10)<<16|e.charCodeAt(11)<<24,f=e.charCodeAt(12)|e.charCodeAt(13)<<8|e.charCodeAt(14)<<16|e.charCodeAt(15)<<24,l=e.charCodeAt(16)|e.charCodeAt(17)<<8|e.charCodeAt(18)<<16|e.charCodeAt(19)<<24,c=e.charCodeAt(20)|e.charCodeAt(21)<<8|e.charCodeAt(22)<<16|e.charCodeAt(23)<<24,h=e.charCodeAt(24)|e.charCodeAt(25)<<8|e.charCodeAt(26)<<16|e.charCodeAt(27)<<24,p=e.charCodeAt(28)|e.charCodeAt(29)<<8|e.charCodeAt(30)<<16|e.charCodeAt(31)<<24,d=e.charCodeAt(32)|e.charCodeAt(33)<<8|e.charCodeAt(34)<<16|e.charCodeAt(35)<<24,v=e.charCodeAt(36)|e.charCodeAt(37)<<8|e.charCodeAt(38)<<16|e.charCodeAt(39)<<24,m=e.charCodeAt(40)|e.charCodeAt(41)<<8|e.charCodeAt(42)<<16|e.charCodeAt(43)<<24,g=e.charCodeAt(44)|e.charCodeAt(45)<<8|e.charCodeAt(46)<<16|e.charCodeAt(47)<<24,y=e.charCodeAt(48)|e.charCodeAt(49)<<8|e.charCodeAt(50)<<16|e.charCodeAt(51)<<24,b=e.charCodeAt(52)|e.charCodeAt(53)<<8|e.charCodeAt(54)<<16|e.charCodeAt(55)<<24,w=e.charCodeAt(56)|e.charCodeAt(57)<<8|e.charCodeAt(58)<<16|e.charCodeAt(59)<<24,E=e.charCodeAt(60)|e.charCodeAt(61)<<8|e.charCodeAt(62)<<16|e.charCodeAt(63)<<24):(o=e.charCodeAt(0)|e.charCodeAt(1)<<16,u=e.charCodeAt(2)|e.charCodeAt(3)<<16,a=e.charCodeAt(4)|e.charCodeAt(5)<<16,f=e.charCodeAt(6)|e.charCodeAt(7)<<16,l=e.charCodeAt(8)|e.charCodeAt(9)<<16,c=e.charCodeAt(10)|e.charCodeAt(11)<<16,h=e.charCodeAt(12)|e.charCodeAt(13)<<16,p=e.charCodeAt(14)|e.charCodeAt(15)<<16,d=e.charCodeAt(16)|e.charCodeAt(17)<<16,v=e.charCodeAt(18)|e.charCodeAt(19)<<16,m=e.charCodeAt(20)|e.charCodeAt(21)<<16,g=e.charCodeAt(22)|e.charCodeAt(23)<<16,y=e.charCodeAt(24)|e.charCodeAt(25)<<16,b=e.charCodeAt(26)|e.charCodeAt(27)<<16,w=e.charCodeAt(28)|e.charCodeAt(29)<<16,E=e.charCodeAt(30)|e.charCodeAt(31)<<16),n+=o+3614090360+(r&i|~r&s),n=r+(n<<7|n>>>25),s+=u+3905402710+(n&r|~n&i),s=n+(s<<12|s>>>20),i+=a+606105819+(s&n|~s&r),i=s+(i<<17|i>>>15),r+=f+3250441966+(i&s|~i&n),r=i+(r<<22|r>>>10),n+=l+4118548399+(r&i|~r&s),n=r+(n<<7|n>>>25),s+=c+1200080426+(n&r|~n&i),s=n+(s<<12|s>>>20),i+=h+2821735955+(s&n|~s&r),i=s+(i<<17|i>>>15),r+=p+4249261313+(i&s|~i&n),r=i+(r<<22|r>>>10),n+=d+1770035416+(r&i|~r&s),n=r+(n<<7|n>>>25),s+=v+2336552879+(n&r|~n&i),s=n+(s<<12|s>>>20),i+=m+4294925233+(s&n|~s&r),i=s+(i<<17|i>>>15),r+=g+2304563134+(i&s|~i&n),r=i+(r<<22|r>>>10),n+=y+1804603682+(r&i|~r&s),n=r+(n<<7|n>>>25),s+=b+4254626195+(n&r|~n&i),s=n+(s<<12|s>>>20),i+=w+2792965006+(s&n|~s&r),i=s+(i<<17|i>>>15),r+=E+1236535329+(i&s|~i&n),r=i+(r<<22|r>>>10),n+=u+4129170786+(r&s|i&~s),n=r+(n<<5|n>>>27),s+=h+3225465664+(n&i|r&~i),s=n+(s<<9|s>>>23),i+=g+643717713+(s&r|n&~r),i=s+(i<<14|i>>>18),r+=o+3921069994+(i&n|s&~n),r=i+(r<<20|r>>>12),n+=c+3593408605+(r&s|i&~s),n=r+(n<<5|n>>>27),s+=m+38016083+(n&i|r&~i),s=n+(s<<9|s>>>23),i+=E+3634488961+(s&r|n&~r),i=s+(i<<14|i>>>18),r+=l+3889429448+(i&n|s&~n),r=i+(r<<20|r>>>12),n+=v+568446438+(r&s|i&~s),n=r+(n<<5|n>>>27),s+=w+3275163606+(n&i|r&~i),s=n+(s<<9|s>>>23),i+=f+4107603335+(s&r|n&~r),i=s+(i<<14|i>>>18),r+=d+1163531501+(i&n|s&~n),r=i+(r<<20|r>>>12),n+=b+2850285829+(r&s|i&~s),n=r+(n<<5|n>>>27),s+=a+4243563512+(n&i|r&~i),s=n+(s<<9|s>>>23),i+=p+1735328473+(s&r|n&~r),i=s+(i<<14|i>>>18),r+=y+2368359562+(i&n|s&~n),r=i+(r<<20|r>>>12),n+=c+4294588738+(r^i^s),n=r+(n<<4|n>>>28),s+=d+2272392833+(n^r^i),s=n+(s<<11|s>>>21),i+=g+1839030562+(s^n^r),i=s+(i<<16|i>>>16),r+=w+4259657740+(i^s^n),r=i+(r<<23|r>>>9),n+=u+2763975236+(r^i^s),n=r+(n<<4|n>>>28),s+=l+1272893353+(n^r^i),s=n+(s<<11|s>>>21),i+=p+4139469664+(s^n^r),i=s+(i<<16|i>>>16),r+=m+3200236656+(i^s^n),r=i+(r<<23|r>>>9),n+=b+681279174+(r^i^s),n=r+(n<<4|n>>>28),s+=o+3936430074+(n^r^i),s=n+(s<<11|s>>>21),i+=f+3572445317+(s^n^r),i=s+(i<<16|i>>>16),r+=h+76029189+(i^s^n),r=i+(r<<23|r>>>9),n+=v+3654602809+(r^i^s),n=r+(n<<4|n>>>28),s+=y+3873151461+(n^r^i),s=n+(s<<11|s>>>21),i+=E+530742520+(s^n^r),i=s+(i<<16|i>>>16),r+=a+3299628645+(i^s^n),r=i+(r<<23|r>>>9),n+=o+4096336452+(i^(~s|r)),n=r+(n<<6|n>>>26),s+=p+1126891415+(r^(~i|n)),s=n+(s<<10|s>>>22),i+=w+2878612391+(n^(~r|s)),i=s+(i<<15|i>>>17),r+=c+4237533241+(s^(~n|i)),r=i+(r<<21|r>>>11),n+=y+1700485571+(i^(~s|r)),n=r+(n<<6|n>>>26),s+=f+2399980690+(r^(~i|n)),s=n+(s<<10|s>>>22),i+=m+4293915773+(n^(~r|s)),i=s+(i<<15|i>>>17),r+=u+2240044497+(s^(~n|i)),r=i+(r<<21|r>>>11),n+=d+1873313359+(i^(~s|r)),n=r+(n<<6|n>>>26),s+=E+4264355552+(r^(~i|n)),s=n+(s<<10|s>>>22),i+=h+2734768916+(n^(~r|s)),i=s+(i<<15|i>>>17),r+=b+1309151649+(s^(~n|i)),r=i+(r<<21|r>>>11),n+=l+4149444226+(i^(~s|r)),n=r+(n<<6|n>>>26),s+=g+3174756917+(r^(~i|n)),s=n+(s<<10|s>>>22),i+=a+718787259+(n^(~r|s)),i=s+(i<<15|i>>>17),r+=v+3951481745+(s^(~n|i)),r=i+(r<<21|r>>>11),this.a_=this.a_+n&4294967295,this.b_=this.b_+r&4294967295,this.c_=this.c_+i&4294967295,this.d_=this.d_+s&4294967295},fillzero:function(e){var t="";for(var n=0;n<e;n++)t+="\0";return t},main:function(e,t,n,r,i){if(i==1){var s=t*8;while(t>=64)r[n](e,i),e=e.substr(64),t-=64;e+="\u0080",t>=56?(e+=this.fillzero(63-t),r[n](e,i),e=this.fillzero(56)):e+=this.fillzero(55-t),e+=String.fromCharCode(s&255,s>>>8&255,s>>>16&255,s>>>24),e+="\0\0\0\0",r[n](e,i)}else{var s=t*16;while(t>=32)r[n](e,i),e=e.substr(32),t-=32;e+="\u0080",t>=28?(e+=this.fillzero(31-t),r[n](e,i),e=this.fillzero(28)):e+=this.fillzero(27-t),e+=String.fromCharCode(s&65535,s>>>16),e+="\0\0",r[n](e,i)}},VERSION:"1.0",BY_ASCII:0,BY_UTF16:1,calc_Fx:function(e,t){var n=arguments.length==2&&t==this.BY_UTF16?2:1;return this.a_=[8961,26437],this.b_=[43913,61389],this.c_=[56574,39098],this.d_=[21622,4146],this.main(e,e.length,"update_Fx",this,n),this.int2hex8_Fx(this.a_)+this.int2hex8_Fx(this.b_)+this.int2hex8_Fx(this.c_)+this.int2hex8_Fx(this.d_)},calc_std:function(e,t){var n=arguments.length==2&&t==this.BY_UTF16?2:1;return this.a_=1732584193,this.b_=4023233417,this.c_=2562383102,this.d_=271733878,this.main(e,e.length,"update_std",this,n),this.int2hex8(this.a_)+this.int2hex8(this.b_)+this.int2hex8(this.c_)+this.int2hex8(this.d_)}}};new function(){t.MD5.calc=navigator.userAgent.match(/Firefox/)?t.MD5.calc_Fx:t.MD5.calc_std},function(e){navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=function(e){this.room=null,this.id=null,this.key=null,this.peers={},this.stream=null,this.tracks_={},this.gainNode_,this.pollInterval=null,this.opened=!1,this.opts=n.util.checkOpts_(e)};n.prototype=new EventEmitter2,n.prototype.conn2SkyWay_=function(){var e=this;this.peer=new Peer(this.opts.id,this.opts.peerjs_opts),this.peer.on("open",function(e){if(this.opened)throw"Error : connection to SkyWay is already opened";this.opened=!0;if(e!==this.opts.id)throw"Error : SkyWay returns wrong peer id for myself";this.fire_("open",e),this.getIDs_(),this.opts.polling&&this.startPollingConnections_()}.bind(this)),this.peer.on("error",function(t){e.fire_("error",t)})},n.prototype.getIDs_=function(){var e=this;e.listAllPeers(function(t){t.forEach(function(t){e.peers[t]={}}),e.opts.use_stream&&e.startMediaStream_(),e.startDataChannel_()})},n.prototype.startPollingConnections_=function(){var e=this;e.pollInterval=setInterval(function(){e.listAllPeers(function(t){for(var n in e.peers){var r=!0;if(n===undefined)return;$.each(t,function(e,t){n===t&&(r=!1)});if(r)e.removePeer(n);else{var i=multiparty.peers[n],s={video:i.call?!i.call.open:!1,screen:i.screen_sender?!i.screen_sender.open:!1,data:i.DCconn?!i.DCconn.open:!1};s.video||s.screen||s.data?(i.reconnectIndex_?i.reconnectIndex_++:i.reconnectIndex_=1,(i.reconnectIndex_&i.reconnectIndex_-1)==0&&e.reconnect(n,s)):i.reconnectIndex_=0}}})},e.opts.polling_interval)},n.prototype.startMediaStream_=function(){this.startMyStream_()},n.prototype.startMyStream_=function(){var e=this;navigator.getUserMedia_({video:e.opts.video_stream,audio:e.opts.audio_stream},function(t){if(window.AudioContext&&window.AudioContext.prototype.createMediaStreamSource&&window.AudioContext.prototype.createMediaStreamDestination){var n=new AudioContext;e.gainNode_=n.createGain();var r=n.createMediaStreamSource(t),i=n.createMediaStreamDestination();i.stream.addTrack?(r.connect(e.gainNode_),e.gainNode_.connect(i),t.getVideoTracks()&&i.stream.addTrack(t.getVideoTracks()[0]),e.stream=i.stream):e.stream=t,e.opts.video_stream&&(e.tracks_.video=e.stream.getVideoTracks()[0]),e.opts.audio_stream&&(e.tracks_.audio=e.stream.getAudioTracks()[0]),e.fire_("my_ms",{src:URL.createObjectURL(e.stream),isUsingPlugin:!1,id:e.opts.id,stream:e.stream}),e.startCall_()}else e.stream=t,e.opts.video_stream&&(e.tracks_.video=e.stream.getVideoTracks()[0]),e.opts.audio_stream&&(e.tracks_.audio=e.stream.getAudioTracks()[0]),e.fire_("my_ms",{src:e.stream,isUsingPlugin:!0,id:e.opts.id,stream:e.stream}),e.startCall_()},function(t){e.fire_("error",t)})},n.prototype.mute=function(e){if(e===undefined){this.tracks_.audio.enabled=!1,this.tracks_.video.enabled=!1,this.gainNode_!==undefined&&(this.gainNode_.gain.value=0);return}e.audio!==undefined&&e.audio===!0&&(this.tracks_.audio.enabled=!1,this.tracks_.audio.muted=!0,this.gainNode_!==undefined&&(this.gainNode_.gain.value=0)),e.video!==undefined&&e.video===!0&&(this.tracks_.video.enabled=!1)},n.prototype.unmute=function(e){if(e===undefined){this.tracks_.audio.enabled=!0,this.tracks_.video.enabled=!0,this.gainNode_!==undefined&&(this.gainNode_.gain.value=3);return}e.audio!==undefined&&e.audio===!0&&(this.tracks_.audio.enabled=!0,this.gainNode_!==undefined&&(this.gainNode_.gain.value=3)),e.video!==undefined&&e.video===!0&&(this.tracks_.video.enabled=!0)},n.prototype.startCall_=function(e){var t=this;for(var n in this.peers)(function(t){if(e===!0){if(!t.peers[n].screen_sender||t.peers[n].screen_sender.open){var r=t.peer.call(n,t.screenStream,{metadata:{type:"screen"}});console.log("peer.call called from screenshare startCall_"),t.peers[n].screen_sender=r,t.setupStreamHandler_(r)}}else{var r=t.peer.call(n,t.stream);console.log("peer.call called from generic media exchange startCall_"),t.peers[n].call=r,t.setupStreamHandler_(r)}})(t);(!this.peer._events.call||this.peer._events.call.length===0)&&this.peer.on("call",function(e){t.peers[e.peer]||(t.peers[e.peer]={});if(e.metadata&&e.metadata.type==="screen")t.peers[e.peer].screen_receiver=e,e.answer(),t.setupStreamHandler_(e);else{t.peers[e.peer].call=e,e.answer(t.stream),t.setupStreamHandler_(e);if(t.screenStream!==undefined){var e=t.peer.call(e.peer,t.screenStream,{metadata:{type:"screen"}});t.peers[e.peer].screen_sender=e}console.log("peer.call called from call callback")}})},n.prototype.setupStreamHandler_=function(e){var t=this,n=!!e.metadata&&!!e.metadata.reconnect;e.on("stream",function(r){e.metadata&&e.metadata.type==="screen"?(t.peers[this.peer].screen_receiver.stream=r,t.setupPeerScreen_(this.peer,r,n)):(t.peers[this.peer].call.stream=r,t.setupPeerVideo_(this.peer,r,n))}).on("close",function(){var e=this.peer,n=this.metadata;t.listAllPeers(function(r){var i=!0;for(var s in r)if(r[s]===e){i=!1;break}i&&(n&&n.type==="screen"?t.fire_("ss_close",e):t.fire_("ms_close",e),t.peers[e]&&(t.peers[e].call===undefined||!t.peers[e].call.open)&&(t.peers[e].DCconn===undefined||!t.peers[e].DCconn.open)&&(t.peers[e].screen_sender===undefined||!t.peers[e].screen_sender.open)&&t.removePeer(e))})})},n.prototype.setupPeerVideo_=function(e,t,n){if(t.value)var r=t,i=!0;else var r=window.URL.createObjectURL(t),i=!1;n=!!n,this.peers[e].video=t,this.fire_("peer_ms",{id:e,src:r,isUsingPlugin:i,reconnect:n})},n.prototype.setupPeerScreen_=function(e,t,n){var r=this;n||(n=!1),r.peers[e].screen_receiver.video=t,r.fire_("peer_ss",{src:URL.createObjectURL(t),id:e,reconnect:n})},n.prototype.removePeer=function(e){try{if(this.peers[e]!==undefined){var t=this.peers[e];t.call&&t.call.close(),t.screen_sender&&t.screen_sender.close(),t.screen_receiver&&t.screen_receiver.close(),t.DCconn&&t.DCconn.close()}}finally{delete this.peers[e]}},n.prototype.startDataChannel_=function(){this.startDCconnection_()},n.prototype.startDCconnection_=function(){var e=this;for(var t in this.peers)this.DCconnect_(t);this.peer.on("connection",function(t){e.peers[t.peer]||(e.peers[t.peer]={}),e.peers[t.peer].DCconn=t,e.setupDCHandler_(t),e.fire_("dc_open",t.peer)})},n.prototype.DCconnect_=function(e){var t=this.peer.connect(e,{serialization:this.opts.serialization,reliable:this.opts.reliable});this.peers[e].DCconn=t,t.on("open",function(){this.setupDCHandler_(t),this.fire_("dc_open",t.peer)}.bind(this))},n.prototype.setupDCHandler_=function(e){var t=this;e.on("data",function(e){t.fire_("message",{id:this.peer,data:e})}).on("close",function(){var e=this.peer,n=this.metadata;t.listAllPeers(function(n){var r=!0;for(var i in n)if(n[i]===e){r=!1;break}r&&(t.fire_("dc_close",e),t.peers[e]&&(t.peers[e].call===undefined||!t.peers[e].call.open)&&(t.peers[e].DCconn===undefined||!t.peers[e].DCconn.open)&&(t.peers[e].screen_sender===undefined||!t.peers[e].screen_sender.open)&&t.removePeer(e))})})},n.prototype.send_=function(e){if(!this.peer)return!1;if(e&&typeof e=="string"&&e.length===0)return!1;if(e&&(typeof e=="string"||typeof e=="object"))for(var t in this.peers)this.peers[t].DCconn&&this.peers[t].DCconn.send(e)},n.prototype.fire_=function(e,t){this.emit(e,t)},n.util={},n.util.checkOpts_=function(e){var t={};if(!e.key||typeof e.key!="string")throw"app key must be specified";if(!e.key.match(/^[0-9a-z]{8}\-[0-9a-z]{4}\-[0-9a-z]{4}\-[0-9a-z]{4}\-[0-9a-z]{12}$/))throw"wrong string pattern of app key";t.key=e.key;if(!e.room||typeof e.room!="string")var r="";else{if(!e.room.match(/^[0-9a-zA-Z\-\_]{4,32}$/))throw"room name should be digit|alphabet and length between 4 and 32";var r=e.room}t.room_name=r,t.room_id=n.util.makeRoomName(r);var i=location.pathname+"_peer_id";return sessionStorage[i]?t.id=sessionStorage[i]:!e.id||typeof e.id!="string"?t.id=t.room_id+n.util.makeID():t.id=t.room_id+e.id,sessionStorage[i]=t.id,e.reliable?t.reliable=!0:t.reliable=!1,e.serialization?t.serialization=e.serialization:t.serialization="binary",t.video_stream=e.video===undefined?!0:e.video,t.audio_stream=e.audio===undefined?!0:e.audio,t.use_stream=t.video_stream||t.audio_stream,t.polling=e.polling===undefined?!0:e.polling,t.polling_interval=e.polling_interval===undefined?3e3:e.polling_interval,t.peerjs_opts={debug:e.debug||!1,key:t.key},e.host&&(t.peerjs_opts.host=e.host),e.port&&(t.peerjs_opts.port=e.port),e.secure&&(t.peerjs_opts.secure=e.secure),e.config&&(t.peerjs_opts.config=e.config),t},n.util.makeID=function(){var e="";for(var t=0;t<32;t++)e+=String.fromCharCode(Math.random()*9+48|0);return e},n.util.makeRoomName=function(e){return e=e||"",e+=location.host+location.pathname,t.MD5.calc(e).substring(0,6)+"R_"},n.util.createVideoNode=function(e){var t=document.getElementById(e.id);t&&t.parentNode.removeChild(t);var n=document.createElement("video");n.setAttribute("id",e.id),e.isUsingPlugin||n.setAttribute("src",e.src);var r=!1;return n.addEventListener("loadedmetadata",function(e){r||(r=!0,this.play())},!1),setTimeout(function(e){r||(r=!0,n.play())},500),n},n.prototype.start=function(){var e=this;return setTimeout(function(){e.conn2SkyWay_()},0),e},n.prototype.send=function(e){this.peer&&this.send_(e)},n.prototype.close=function(){this.peer&&this.peer.destroy(),clearInterval(this.pollInterval)},n.prototype.startScreenShare=function(e,t){if(this.peer){var n=this;if(SkyWay&&SkyWay.ScreenShare){var r=new SkyWay.ScreenShare;r.isEnabledExtension()&&r.startScreenShare({Width:screen.width,Height:screen.height,FrameRate:5},function(t){n.screenStream=t,n.startCall_(!0),util.log("MediaConnection created in OFFER"),e(t)},t)}}},n.prototype.stopScreenShare=function(){if(this.screenStream){this.screenStream.stop();for(var e in this.peers)this.peers[e].screen_sender&&this.peers[e].screen_sender.close(),delete this.peers[e].screen_sender;this.screenStream=undefined}},n.prototype.listAllPeers=function(e){var t=this;this.peer.listAllPeers(function(n){var r=[];n.forEach(function(e){e!==t.opts.id&&e.indexOf(t.opts.room_id)===0&&r.push(e)}),e(r)})},n.prototype.reconnect=function(e,t){var n=this,r=n.peers[e];t===undefined&&(t={video:!0,screen:!0,data:!0});if(r){if(t.video){r.call&&r.call.close&&r.call.close();var i=n.peer.call(e,n.stream,{metadata:{reconnect:!0}});console.log("peer.call called from reconnect method"),r.call=i,n.setupStreamHandler_(i)}if(t.screen&&n.screenStream){r.screen_sender&&r.screen_sender.close&&r.screen_sender.close();var i=n.peer.call(e,n.screenStream,{metadata:{reconnect:!0,type:"screen"}});console.log("peer.call called from reconnect method in screenshare"),r.screen_sender=i}if(t.data){r.DCconn&&r.DCconn.close&&r.DCconn.close();var s=this.peer.connect(e,{serialization:this.opts.serialization,reliable:this.opts.reliable,metadata:{reconnect:!0}}).on("open",function(){r.DCconn=s,n.setupDCHandler_(s)})}}},e.MultiParty||(e.MultiParty=n)}(window)})(this)