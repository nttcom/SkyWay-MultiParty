{"version":3,"sources":["webpack:///webpack/bootstrap b185c2dba5b78b59ebd1","webpack:///./~/skyway-peerjs/lib/util.js","webpack:///./~/eventemitter3/index.js","webpack:///./~/skyway-peerjs/lib/adapter.js","webpack:///./~/charenc/charenc.js","webpack:///./~/js-binarypack/lib/binarypack.js","webpack:///./~/js-binarypack/lib/bufferbuilder.js","webpack:///./~/skyway-peerjs/lib/negotiator.js","webpack:///./lib/MultiParty.js","webpack:///(webpack)/buildin/module.js","webpack:///./lib/index.js","webpack:///./lib/util.js","webpack:///./~/crypt/crypt.js","webpack:///./~/events/events.js","webpack:///./~/is-buffer/index.js","webpack:///./~/md5/md5.js","webpack:///./~/reliable/lib/reliable.js","webpack:///./~/reliable/lib/util.js","webpack:///./~/skyway-peerjs/lib/dataconnection.js","webpack:///./~/skyway-peerjs/lib/mediaconnection.js","webpack:///./~/skyway-peerjs/lib/peer.js","webpack:///./~/skyway-peerjs/lib/socket.js"],"names":["EventEmitter","require","util","Peer","navigator","getUserMedia_","getUserMedia","webkitGetUserMedia","mozGetUserMedia","MultiParty","opts","room","id","key","peers","stream","tracks_","pollInterval","opened","checkOpts_","self","peer","peerjs_opts","on","fire_","getIDs_","polling","startPollingConnections_","bind","err","listAllPeers","forEach","peer_id","use_stream","startMediaStream_","startDataChannel_","setInterval","newList","removeId","undefined","$","each","j","peerId","removePeer","reconnect","video","call","open","screen","screen_sender","data","DCconn","reconnectIndex_","polling_interval","startMyStream_","video_stream","audio_stream","audio","getAudioTracks","getVideoTracks","URL","createObjectURL","startCall_","target_track","enabled","isScreen","screenStream","metadata","type","console","log","setupStreamHandler_","_events","length","screen_receiver","answer","isReconnect","setupPeerScreen_","setupPeerVideo_","isScreenShare","isSSCaller","list","isDisconnected","index","url","window","src","close","startDCconnection_","DCconnect_","conn","setupDCHandler_","connect","serialization","reliable","send","name","obj","emit","setTimeout","conn2SkyWay_","send_","destroy","clearInterval","success","error","SkyWay","ScreenShare","sc","isEnabledExtension","startScreenShare","Width","width","Height","height","FrameRate","stop","callback","roomPeers","indexOf","room_id","push","connections","module","exports","md5","opts_","match","seed","room_name","makeRoomName","hash_","location","pathname","sessionStorage","makeID","debug","host","port","secure","config","i","String","fromCharCode","Math","random","substring","createVideoNode","prev_node","document","getElementById","parentNode","removeChild","v_","createElement","setAttribute","played","addEventListener","ev","play"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,qBAAqB,gBAAgB,wEAAwE;AAC7G;;AAEA;AACA;;AAEA;AACA,qBAAqB;;AAErB;AACA;AACA;AACA;;AAEA;AACA,oBAAoB,YAAY;AAChC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,oCAAoC,OAAO;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC,sCAAsC;AACtC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iDAAiD,YAAY,sBAAsB,EAAE;AACrF,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA,8DAA8D;AAC9D;AACA,+EAA+E;AAC/E;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gEAAgE,YAAY,sBAAsB,EAAE;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;AAClC,oCAAoC;AACpC;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;;AAGH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,OAAO;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;;;;;;;AC1UA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;;AAEzB;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa;AACb;AACA;AACA;AACA;;AAEA,0DAA0D,OAAO;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yCAAyC,SAAS;AAClD;AACA;;AAEA;AACA,GAAG;AACH,eAAe,YAAY;AAC3B;;AAEA;AACA,2DAA2D;AAC3D,+DAA+D;AAC/D,mEAAmE;AACnE;AACA,0DAA0D,SAAS;AACnE;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oDAAoD,YAAY;AAChE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;AC3MA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA,KAAK;;AAEL;AACA;AACA,+BAA+B,kBAAkB;AACjD;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AChCA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,WAAW;AAC3B;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,WAAW;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,gBAAgB,aAAa;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;ACtgBA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2CAA2C,QAAQ;AACnD;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;;;;;;;AC/DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,GAAG,cAAc,SAAS,WAAW;AACrC,iBAAiB;AACjB;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB,OAAO;AACP;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAoC,QAAQ;AAC5C;AACA;AACA,cAAc;AACd;AACA;AACA,GAAG;AACH,mBAAmB;AACnB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,CAAC;;;AAGD;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,YAAY,sBAAsB;AAClD,GAAG;AACH;AACA,gBAAgB,YAAY,2BAA2B;AACvD;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AA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H;AACD;AACF,GALD,EAKG,GALH;;AAOA,SAAON,EAAP;AACD,CA7BD;;AAgCA9B,OAAOC,OAAP,GAAiB3H,IAAjB,C;;;;;;ACnJA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qBAAqB,cAAc;AACnC;AACA;AACA,KAAK;;AAEL;AACA;AACA,0BAA0B,OAAO;AACjC;AACA;AACA,KAAK;;AAEL;AACA;AACA,wCAAwC,kBAAkB;AAC1D;AACA;AACA,KAAK;;AAEL;AACA;AACA,iCAAiC,uBAAuB;AACxD;AACA;AACA,KAAK;;AAEL;AACA;AACA,+BAA+B,kBAAkB;AACjD;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA,KAAK;;AAEL;AACA;AACA,kCAAkC,kBAAkB;AACpD;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;AC/FD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;AC7SA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;ACpBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,cAAc;;AAEjC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;;;;;;AC/JD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAA0C,QAAQ;AAClD;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,WAAW;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;AC7TA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,sBAAsB;AAC3C;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,K;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;;;;;;;AC9FA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA,8CAA8C;;AAE9C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,WAAW;AAC1C;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK,O;AACL;AACA;;AAEA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,QAAQ;AAC5C;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AClRA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B;;AAE/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,oCAAoC;;AAEpC;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,QAAQ;AAC/C;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AChGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yBAAyB;AACzB,4BAA4B;AAC5B,oBAAoB;AACpB;;AAEA;AACA,wBAAwB;AACxB,0BAA0B;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,6CAA6C,QAAQ;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,QAAQ;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0CAA0C,QAAQ;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACnjBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,2CAA2C;AAC3C;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,QAAQ;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,YAAY;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"multiparty.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b185c2dba5b78b59ebd1","var defaultConfig = {'iceServers': [{ 'urls': 'stun:stun.skyway.io:3478' , 'url': 'stun:stun.skyway.io:3478'}]};\nvar dataCount = 1;\n\nvar BinaryPack = require('js-binarypack');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\n\nvar util = {\n  noop: function() {},\n\n  CLOUD_HOST: 'skyway.io',\n  CLOUD_PORT: 443,\n  TURN_HOST: 'turn.skyway.io',\n  TURN_PORT: 443,\n\n  // Browsers that need chunking:\n  chunkedBrowsers: {'Chrome': 1},\n  chunkedMTU: 16300, // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n  // Logging logic\n  logLevel: 0,\n  setLogLevel: function(level) {\n    var debugLevel = parseInt(level, 10);\n    if (!isNaN(parseInt(level, 10))) {\n      util.logLevel = debugLevel;\n    } else {\n      // If they are using truthy/falsy values for debug\n      util.logLevel = level ? 3 : 0;\n    }\n    util.log = util.warn = util.error = util.noop;\n    if (util.logLevel > 0) {\n      util.error = util._printWith('ERROR');\n    }\n    if (util.logLevel > 1) {\n      util.warn = util._printWith('WARNING');\n    }\n    if (util.logLevel > 2) {\n      util.log = util._print;\n    }\n  },\n  setLogFunction: function(fn) {\n    if (fn.constructor !== Function) {\n      util.warn('The log function you passed in is not a function. Defaulting to regular logs.');\n    } else {\n      util._print = fn;\n    }\n  },\n\n  _printWith: function(prefix) {\n    return function() {\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift(prefix);\n      util._print.apply(util, copy);\n    };\n  },\n  _print: function () {\n    var err = false;\n    var copy = Array.prototype.slice.call(arguments);\n    copy.unshift('PeerJS: ');\n    for (var i = 0, l = copy.length; i < l; i++){\n      if (copy[i] instanceof Error) {\n        copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n        err = true;\n      }\n    }\n    err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n  },\n  //\n\n  // Returns browser-agnostic default config\n  defaultConfig: defaultConfig,\n  //\n\n  // Returns the current browser.\n  browser: (function() {\n    if (window.mozRTCPeerConnection) {\n      return 'Firefox';\n    } else if (window.webkitRTCPeerConnection) {\n      return 'Chrome';\n    } else if (window.RTCPeerConnection) {\n      return 'Supported';\n    } else {\n      return 'Unsupported';\n    }\n  })(),\n  //\n\n  // Lists which features are supported\n  supports: (function() {\n    if (typeof RTCPeerConnection === 'undefined') {\n      return {};\n    }\n\n/*change log*/\n    if (typeof window.AdapterJS !== 'undefined' && (window.webrtcDetectedBrowser === 'IE' ||\n      window.webrtcDetectedBrowser === 'safari')) {\n      return {\n        audioVideo: true,\n        data: true,\n        binaryBlob: false,\n        binary: false, // deprecated; sctp implies binary support.\n        reliable: true, // deprecated; sctp implies reliable data.\n        sctp: true,\n        onnegotiationneeded: false\n      };\n    }\n\n    var data = true;\n    var audioVideo = true;\n\n    var binaryBlob = false;\n    var sctp = false;\n    var onnegotiationneeded = !!window.webkitRTCPeerConnection;\n\n    var pc, dc;\n    try {\n      pc = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n    } catch (e) {\n      data = false;\n      audioVideo = false;\n    }\n\n    if (data) {\n      try {\n        dc = pc.createDataChannel('_PEERJSTEST');\n      } catch (e) {\n        data = false;\n      }\n    }\n\n    if (data) {\n      // Binary test\n      try {\n        dc.binaryType = 'blob';\n        binaryBlob = true;\n      } catch (e) {\n      }\n\n      // Reliable test.\n      // Unfortunately Chrome is a bit unreliable about whether or not they\n      // support reliable.\n      var reliablePC = new RTCPeerConnection(defaultConfig, {});\n      try {\n        var reliableDC = reliablePC.createDataChannel('_PEERJSRELIABLETEST', {});\n        sctp = reliableDC.reliable;\n      } catch (e) {\n      }\n      reliablePC.close();\n    }\n\n    // FIXME: not really the best check...\n    if (audioVideo) {\n      audioVideo = !!pc.addStream;\n    }\n\n    // FIXME: this is not great because in theory it doesn't work for\n    // av-only browsers (?).\n    if (!onnegotiationneeded && data) {\n      // sync default check.\n      var negotiationPC = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n      negotiationPC.onnegotiationneeded = function() {\n        onnegotiationneeded = true;\n        // async check.\n        if (util && util.supports) {\n          util.supports.onnegotiationneeded = true;\n        }\n      };\n      negotiationPC.createDataChannel('_PEERJSNEGOTIATIONTEST');\n\n      setTimeout(function() {\n        negotiationPC.close();\n      }, 1000);\n    }\n\n    if (pc) {\n      pc.close();\n    }\n\n    return {\n      audioVideo: audioVideo,\n      data: data,\n      binaryBlob: binaryBlob,\n      binary: sctp, // deprecated; sctp implies binary support.\n      reliable: sctp, // deprecated; sctp implies reliable data.\n      sctp: sctp,\n      onnegotiationneeded: onnegotiationneeded\n    };\n  }()),\n  //\n\n  // Ensure alphanumeric ids\n  validateId: function(id) {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(id);\n  },\n\n  validateKey: function(key) {\n    // Allow empty keys\n    return !key || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(key);\n  },\n\n\n  debug: false,\n\n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n\n  log: function () {\n    if (util.debug) {\n      var err = false;\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift('PeerJS: ');\n      for (var i = 0, l = copy.length; i < l; i++){\n        if (copy[i] instanceof Error) {\n          copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n          err = true;\n        }\n      }\n      err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(window)),\n\n  // Binary stuff\n\n  // chunks a blob.\n  chunk: function(bl) {\n    var chunks = [];\n    var size = bl.size;\n    var start = index = 0;\n    var total = Math.ceil(size / util.chunkedMTU);\n    while (start < size) {\n      var end = Math.min(size, start + util.chunkedMTU);\n      var b = bl.slice(start, end);\n\n      var chunk = {\n        __peerData: dataCount,\n        n: index,\n        data: b,\n        total: total\n      };\n\n      chunks.push(chunk);\n\n      start = end;\n      index += 1;\n    }\n    dataCount += 1;\n    return chunks;\n  },\n\n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  },\n  //\n\n  isSecure: function() {\n    return location.protocol === 'https:';\n  },\n  supportsKeepAlive: false\n};\n\nmodule.exports = util;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/util.js\n// module id = 0\n// module chunks = 0","'use strict';\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} once Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Holds the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @returns {Array}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  if (!this._events || !this._events[event]) return [];\n\n  for (var i = 0, l = this._events[event].length, ee = []; i < l; i++) {\n    ee.push(this._events[event][i].fn);\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  if (!this._events || !this._events[event]) return false;\n\n  var listeners = this._events[event]\n    , length = listeners.length\n    , len = arguments.length\n    , ee = listeners[0]\n    , args\n    , i, j;\n\n  if (1 === length) {\n    if (ee.once) this.removeListener(event, ee.fn, true);\n\n    switch (len) {\n      case 1: return ee.fn.call(ee.context), true;\n      case 2: return ee.fn.call(ee.context, a1), true;\n      case 3: return ee.fn.call(ee.context, a1, a2), true;\n      case 4: return ee.fn.call(ee.context, a1, a2, a3), true;\n      case 5: return ee.fn.call(ee.context, a1, a2, a3, a4), true;\n      case 6: return ee.fn.call(ee.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    ee.fn.apply(ee.context, args);\n  } else {\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Functon} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE( fn, context || this ));\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE(fn, context || this, true ));\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, once) {\n  if (!this._events || !this._events[event]) return this;\n\n  var listeners = this._events[event]\n    , events = [];\n\n  if (fn) for (var i = 0, length = listeners.length; i < length; i++) {\n    if (listeners[i].fn !== fn && listeners[i].once !== once) {\n      events.push(listeners[i]);\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) this._events[event] = events;\n  else this._events[event] = null;\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) this._events[event] = null;\n  else this._events = {};\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the module.\n//\nEventEmitter.EventEmitter = EventEmitter;\nEventEmitter.EventEmitter2 = EventEmitter;\nEventEmitter.EventEmitter3 = EventEmitter;\n\nif ('object' === typeof module && module.exports) {\n  module.exports = EventEmitter;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/eventemitter3/index.js\n// module id = 1\n// module chunks = 0","module.exports.RTCSessionDescription = window.RTCSessionDescription ||\n\twindow.mozRTCSessionDescription;\nmodule.exports.RTCPeerConnection = window.RTCPeerConnection ||\n\twindow.mozRTCPeerConnection || window.webkitRTCPeerConnection;\nmodule.exports.RTCIceCandidate = window.RTCIceCandidate ||\n\twindow.mozRTCIceCandidate;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/adapter.js\n// module id = 2\n// module chunks = 0","var charenc = {\n  // UTF-8 encoding\n  utf8: {\n    // Convert a string to a byte array\n    stringToBytes: function(str) {\n      return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)));\n    },\n\n    // Convert a byte array to a string\n    bytesToString: function(bytes) {\n      return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)));\n    }\n  },\n\n  // Binary encoding\n  bin: {\n    // Convert a string to a byte array\n    stringToBytes: function(str) {\n      for (var bytes = [], i = 0; i < str.length; i++)\n        bytes.push(str.charCodeAt(i) & 0xFF);\n      return bytes;\n    },\n\n    // Convert a byte array to a string\n    bytesToString: function(bytes) {\n      for (var str = [], i = 0; i < bytes.length; i++)\n        str.push(String.fromCharCode(bytes[i]));\n      return str.join('');\n    }\n  }\n};\n\nmodule.exports = charenc;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/charenc/charenc.js\n// module id = 3\n// module chunks = 0","var BufferBuilder = require('./bufferbuilder').BufferBuilder;\r\nvar binaryFeatures = require('./bufferbuilder').binaryFeatures;\r\n\r\nvar BinaryPack = {\r\n  unpack: function(data){\r\n    var unpacker = new Unpacker(data);\r\n    return unpacker.unpack();\r\n  },\r\n  pack: function(data){\r\n    var packer = new Packer();\r\n    packer.pack(data);\r\n    var buffer = packer.getBuffer();\r\n    return buffer;\r\n  }\r\n};\r\n\r\nmodule.exports = BinaryPack;\r\n\r\nfunction Unpacker (data){\r\n  // Data is ArrayBuffer\r\n  this.index = 0;\r\n  this.dataBuffer = data;\r\n  this.dataView = new Uint8Array(this.dataBuffer);\r\n  this.length = this.dataBuffer.byteLength;\r\n}\r\n\r\nUnpacker.prototype.unpack = function(){\r\n  var type = this.unpack_uint8();\r\n  if (type < 0x80){\r\n    var positive_fixnum = type;\r\n    return positive_fixnum;\r\n  } else if ((type ^ 0xe0) < 0x20){\r\n    var negative_fixnum = (type ^ 0xe0) - 0x20;\r\n    return negative_fixnum;\r\n  }\r\n  var size;\r\n  if ((size = type ^ 0xa0) <= 0x0f){\r\n    return this.unpack_raw(size);\r\n  } else if ((size = type ^ 0xb0) <= 0x0f){\r\n    return this.unpack_string(size);\r\n  } else if ((size = type ^ 0x90) <= 0x0f){\r\n    return this.unpack_array(size);\r\n  } else if ((size = type ^ 0x80) <= 0x0f){\r\n    return this.unpack_map(size);\r\n  }\r\n  switch(type){\r\n    case 0xc0:\r\n      return null;\r\n    case 0xc1:\r\n      return undefined;\r\n    case 0xc2:\r\n      return false;\r\n    case 0xc3:\r\n      return true;\r\n    case 0xca:\r\n      return this.unpack_float();\r\n    case 0xcb:\r\n      return this.unpack_double();\r\n    case 0xcc:\r\n      return this.unpack_uint8();\r\n    case 0xcd:\r\n      return this.unpack_uint16();\r\n    case 0xce:\r\n      return this.unpack_uint32();\r\n    case 0xcf:\r\n      return this.unpack_uint64();\r\n    case 0xd0:\r\n      return this.unpack_int8();\r\n    case 0xd1:\r\n      return this.unpack_int16();\r\n    case 0xd2:\r\n      return this.unpack_int32();\r\n    case 0xd3:\r\n      return this.unpack_int64();\r\n    case 0xd4:\r\n      return undefined;\r\n    case 0xd5:\r\n      return undefined;\r\n    case 0xd6:\r\n      return undefined;\r\n    case 0xd7:\r\n      return undefined;\r\n    case 0xd8:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_string(size);\r\n    case 0xd9:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_string(size);\r\n    case 0xda:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_raw(size);\r\n    case 0xdb:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_raw(size);\r\n    case 0xdc:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_array(size);\r\n    case 0xdd:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_array(size);\r\n    case 0xde:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_map(size);\r\n    case 0xdf:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_map(size);\r\n  }\r\n}\r\n\r\nUnpacker.prototype.unpack_uint8 = function(){\r\n  var byte = this.dataView[this.index] & 0xff;\r\n  this.index++;\r\n  return byte;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint16 = function(){\r\n  var bytes = this.read(2);\r\n  var uint16 =\r\n    ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\r\n  this.index += 2;\r\n  return uint16;\r\n}\r\n\r\nUnpacker.prototype.unpack_uint32 = function(){\r\n  var bytes = this.read(4);\r\n  var uint32 =\r\n     ((bytes[0]  * 256 +\r\n       bytes[1]) * 256 +\r\n       bytes[2]) * 256 +\r\n       bytes[3];\r\n  this.index += 4;\r\n  return uint32;\r\n}\r\n\r\nUnpacker.prototype.unpack_uint64 = function(){\r\n  var bytes = this.read(8);\r\n  var uint64 =\r\n   ((((((bytes[0]  * 256 +\r\n       bytes[1]) * 256 +\r\n       bytes[2]) * 256 +\r\n       bytes[3]) * 256 +\r\n       bytes[4]) * 256 +\r\n       bytes[5]) * 256 +\r\n       bytes[6]) * 256 +\r\n       bytes[7];\r\n  this.index += 8;\r\n  return uint64;\r\n}\r\n\r\n\r\nUnpacker.prototype.unpack_int8 = function(){\r\n  var uint8 = this.unpack_uint8();\r\n  return (uint8 < 0x80 ) ? uint8 : uint8 - (1 << 8);\r\n};\r\n\r\nUnpacker.prototype.unpack_int16 = function(){\r\n  var uint16 = this.unpack_uint16();\r\n  return (uint16 < 0x8000 ) ? uint16 : uint16 - (1 << 16);\r\n}\r\n\r\nUnpacker.prototype.unpack_int32 = function(){\r\n  var uint32 = this.unpack_uint32();\r\n  return (uint32 < Math.pow(2, 31) ) ? uint32 :\r\n    uint32 - Math.pow(2, 32);\r\n}\r\n\r\nUnpacker.prototype.unpack_int64 = function(){\r\n  var uint64 = this.unpack_uint64();\r\n  return (uint64 < Math.pow(2, 63) ) ? uint64 :\r\n    uint64 - Math.pow(2, 64);\r\n}\r\n\r\nUnpacker.prototype.unpack_raw = function(size){\r\n  if ( this.length < this.index + size){\r\n    throw new Error('BinaryPackFailure: index is out of range'\r\n      + ' ' + this.index + ' ' + size + ' ' + this.length);\r\n  }\r\n  var buf = this.dataBuffer.slice(this.index, this.index + size);\r\n  this.index += size;\r\n\r\n    //buf = util.bufferToString(buf);\r\n\r\n  return buf;\r\n}\r\n\r\nUnpacker.prototype.unpack_string = function(size){\r\n  var bytes = this.read(size);\r\n  var i = 0, str = '', c, code;\r\n  while(i < size){\r\n    c = bytes[i];\r\n    if ( c < 128){\r\n      str += String.fromCharCode(c);\r\n      i++;\r\n    } else if ((c ^ 0xc0) < 32){\r\n      code = ((c ^ 0xc0) << 6) | (bytes[i+1] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 2;\r\n    } else {\r\n      code = ((c & 15) << 12) | ((bytes[i+1] & 63) << 6) |\r\n        (bytes[i+2] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 3;\r\n    }\r\n  }\r\n  this.index += size;\r\n  return str;\r\n}\r\n\r\nUnpacker.prototype.unpack_array = function(size){\r\n  var objects = new Array(size);\r\n  for(var i = 0; i < size ; i++){\r\n    objects[i] = this.unpack();\r\n  }\r\n  return objects;\r\n}\r\n\r\nUnpacker.prototype.unpack_map = function(size){\r\n  var map = {};\r\n  for(var i = 0; i < size ; i++){\r\n    var key  = this.unpack();\r\n    var value = this.unpack();\r\n    map[key] = value;\r\n  }\r\n  return map;\r\n}\r\n\r\nUnpacker.prototype.unpack_float = function(){\r\n  var uint32 = this.unpack_uint32();\r\n  var sign = uint32 >> 31;\r\n  var exp  = ((uint32 >> 23) & 0xff) - 127;\r\n  var fraction = ( uint32 & 0x7fffff ) | 0x800000;\r\n  return (sign == 0 ? 1 : -1) *\r\n    fraction * Math.pow(2, exp - 23);\r\n}\r\n\r\nUnpacker.prototype.unpack_double = function(){\r\n  var h32 = this.unpack_uint32();\r\n  var l32 = this.unpack_uint32();\r\n  var sign = h32 >> 31;\r\n  var exp  = ((h32 >> 20) & 0x7ff) - 1023;\r\n  var hfrac = ( h32 & 0xfffff ) | 0x100000;\r\n  var frac = hfrac * Math.pow(2, exp - 20) +\r\n    l32   * Math.pow(2, exp - 52);\r\n  return (sign == 0 ? 1 : -1) * frac;\r\n}\r\n\r\nUnpacker.prototype.read = function(length){\r\n  var j = this.index;\r\n  if (j + length <= this.length) {\r\n    return this.dataView.subarray(j, j + length);\r\n  } else {\r\n    throw new Error('BinaryPackFailure: read index out of range');\r\n  }\r\n}\r\n\r\nfunction Packer(){\r\n  this.bufferBuilder = new BufferBuilder();\r\n}\r\n\r\nPacker.prototype.getBuffer = function(){\r\n  return this.bufferBuilder.getBuffer();\r\n}\r\n\r\nPacker.prototype.pack = function(value){\r\n  var type = typeof(value);\r\n  if (type == 'string'){\r\n    this.pack_string(value);\r\n  } else if (type == 'number'){\r\n    if (Math.floor(value) === value){\r\n      this.pack_integer(value);\r\n    } else{\r\n      this.pack_double(value);\r\n    }\r\n  } else if (type == 'boolean'){\r\n    if (value === true){\r\n      this.bufferBuilder.append(0xc3);\r\n    } else if (value === false){\r\n      this.bufferBuilder.append(0xc2);\r\n    }\r\n  } else if (type == 'undefined'){\r\n    this.bufferBuilder.append(0xc0);\r\n  } else if (type == 'object'){\r\n    if (value === null){\r\n      this.bufferBuilder.append(0xc0);\r\n    } else {\r\n      var constructor = value.constructor;\r\n      if (constructor == Array){\r\n        this.pack_array(value);\r\n      } else if (constructor == Blob || constructor == File) {\r\n        this.pack_bin(value);\r\n      } else if (constructor == ArrayBuffer) {\r\n        if(binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value));\r\n        } else {\r\n          this.pack_bin(value);\r\n        }\r\n      } else if ('BYTES_PER_ELEMENT' in value){\r\n        if(binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value.buffer));\r\n        } else {\r\n          this.pack_bin(value.buffer);\r\n        }\r\n      } else if (constructor == Object){\r\n        this.pack_object(value);\r\n      } else if (constructor == Date){\r\n        this.pack_string(value.toString());\r\n      } else if (typeof value.toBinaryPack == 'function'){\r\n        this.bufferBuilder.append(value.toBinaryPack());\r\n      } else {\r\n        throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\r\n      }\r\n    }\r\n  } else {\r\n    throw new Error('Type \"' + type + '\" not yet supported');\r\n  }\r\n  this.bufferBuilder.flush();\r\n}\r\n\r\n\r\nPacker.prototype.pack_bin = function(blob){\r\n  var length = blob.length || blob.byteLength || blob.size;\r\n  if (length <= 0x0f){\r\n    this.pack_uint8(0xa0 + length);\r\n  } else if (length <= 0xffff){\r\n    this.bufferBuilder.append(0xda) ;\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff){\r\n    this.bufferBuilder.append(0xdb);\r\n    this.pack_uint32(length);\r\n  } else{\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(blob);\r\n}\r\n\r\nPacker.prototype.pack_string = function(str){\r\n  var length = utf8Length(str);\r\n\r\n  if (length <= 0x0f){\r\n    this.pack_uint8(0xb0 + length);\r\n  } else if (length <= 0xffff){\r\n    this.bufferBuilder.append(0xd8) ;\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff){\r\n    this.bufferBuilder.append(0xd9);\r\n    this.pack_uint32(length);\r\n  } else{\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(str);\r\n}\r\n\r\nPacker.prototype.pack_array = function(ary){\r\n  var length = ary.length;\r\n  if (length <= 0x0f){\r\n    this.pack_uint8(0x90 + length);\r\n  } else if (length <= 0xffff){\r\n    this.bufferBuilder.append(0xdc)\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff){\r\n    this.bufferBuilder.append(0xdd);\r\n    this.pack_uint32(length);\r\n  } else{\r\n    throw new Error('Invalid length');\r\n  }\r\n  for(var i = 0; i < length ; i++){\r\n    this.pack(ary[i]);\r\n  }\r\n}\r\n\r\nPacker.prototype.pack_integer = function(num){\r\n  if ( -0x20 <= num && num <= 0x7f){\r\n    this.bufferBuilder.append(num & 0xff);\r\n  } else if (0x00 <= num && num <= 0xff){\r\n    this.bufferBuilder.append(0xcc);\r\n    this.pack_uint8(num);\r\n  } else if (-0x80 <= num && num <= 0x7f){\r\n    this.bufferBuilder.append(0xd0);\r\n    this.pack_int8(num);\r\n  } else if ( 0x0000 <= num && num <= 0xffff){\r\n    this.bufferBuilder.append(0xcd);\r\n    this.pack_uint16(num);\r\n  } else if (-0x8000 <= num && num <= 0x7fff){\r\n    this.bufferBuilder.append(0xd1);\r\n    this.pack_int16(num);\r\n  } else if ( 0x00000000 <= num && num <= 0xffffffff){\r\n    this.bufferBuilder.append(0xce);\r\n    this.pack_uint32(num);\r\n  } else if (-0x80000000 <= num && num <= 0x7fffffff){\r\n    this.bufferBuilder.append(0xd2);\r\n    this.pack_int32(num);\r\n  } else if (-0x8000000000000000 <= num && num <= 0x7FFFFFFFFFFFFFFF){\r\n    this.bufferBuilder.append(0xd3);\r\n    this.pack_int64(num);\r\n  } else if (0x0000000000000000 <= num && num <= 0xFFFFFFFFFFFFFFFF){\r\n    this.bufferBuilder.append(0xcf);\r\n    this.pack_uint64(num);\r\n  } else{\r\n    throw new Error('Invalid integer');\r\n  }\r\n}\r\n\r\nPacker.prototype.pack_double = function(num){\r\n  var sign = 0;\r\n  if (num < 0){\r\n    sign = 1;\r\n    num = -num;\r\n  }\r\n  var exp  = Math.floor(Math.log(num) / Math.LN2);\r\n  var frac0 = num / Math.pow(2, exp) - 1;\r\n  var frac1 = Math.floor(frac0 * Math.pow(2, 52));\r\n  var b32   = Math.pow(2, 32);\r\n  var h32 = (sign << 31) | ((exp+1023) << 20) |\r\n      (frac1 / b32) & 0x0fffff;\r\n  var l32 = frac1 % b32;\r\n  this.bufferBuilder.append(0xcb);\r\n  this.pack_int32(h32);\r\n  this.pack_int32(l32);\r\n}\r\n\r\nPacker.prototype.pack_object = function(obj){\r\n  var keys = Object.keys(obj);\r\n  var length = keys.length;\r\n  if (length <= 0x0f){\r\n    this.pack_uint8(0x80 + length);\r\n  } else if (length <= 0xffff){\r\n    this.bufferBuilder.append(0xde);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff){\r\n    this.bufferBuilder.append(0xdf);\r\n    this.pack_uint32(length);\r\n  } else{\r\n    throw new Error('Invalid length');\r\n  }\r\n  for(var prop in obj){\r\n    if (obj.hasOwnProperty(prop)){\r\n      this.pack(prop);\r\n      this.pack(obj[prop]);\r\n    }\r\n  }\r\n}\r\n\r\nPacker.prototype.pack_uint8 = function(num){\r\n  this.bufferBuilder.append(num);\r\n}\r\n\r\nPacker.prototype.pack_uint16 = function(num){\r\n  this.bufferBuilder.append(num >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n}\r\n\r\nPacker.prototype.pack_uint32 = function(num){\r\n  var n = num & 0xffffffff;\r\n  this.bufferBuilder.append((n & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((n & 0x0000ff00) >>>  8);\r\n  this.bufferBuilder.append((n & 0x000000ff));\r\n}\r\n\r\nPacker.prototype.pack_uint64 = function(num){\r\n  var high = num / Math.pow(2, 32);\r\n  var low  = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\r\n  this.bufferBuilder.append((low  & 0x000000ff));\r\n}\r\n\r\nPacker.prototype.pack_int8 = function(num){\r\n  this.bufferBuilder.append(num & 0xff);\r\n}\r\n\r\nPacker.prototype.pack_int16 = function(num){\r\n  this.bufferBuilder.append((num & 0xff00) >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n}\r\n\r\nPacker.prototype.pack_int32 = function(num){\r\n  this.bufferBuilder.append((num >>> 24) & 0xff);\r\n  this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((num & 0x000000ff));\r\n}\r\n\r\nPacker.prototype.pack_int64 = function(num){\r\n  var high = Math.floor(num / Math.pow(2, 32));\r\n  var low  = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\r\n  this.bufferBuilder.append((low  & 0x000000ff));\r\n}\r\n\r\nfunction _utf8Replace(m){\r\n  var code = m.charCodeAt(0);\r\n\r\n  if(code <= 0x7ff) return '00';\r\n  if(code <= 0xffff) return '000';\r\n  if(code <= 0x1fffff) return '0000';\r\n  if(code <= 0x3ffffff) return '00000';\r\n  return '000000';\r\n}\r\n\r\nfunction utf8Length(str){\r\n  if (str.length > 600) {\r\n    // Blob method faster for large strings\r\n    return (new Blob([str])).size;\r\n  } else {\r\n    return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\r\n  }\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/js-binarypack/lib/binarypack.js\n// module id = 4\n// module chunks = 0","var binaryFeatures = {};\r\nbinaryFeatures.useBlobBuilder = (function(){\r\n  try {\r\n    new Blob([]);\r\n    return false;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nbinaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function(){\r\n  try {\r\n    return (new Blob([new Uint8Array([])])).size === 0;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nmodule.exports.binaryFeatures = binaryFeatures;\r\nvar BlobBuilder = module.exports.BlobBuilder;\r\nif (typeof window != 'undefined') {\r\n  BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\r\n    window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\r\n}\r\n\r\nfunction BufferBuilder(){\r\n  this._pieces = [];\r\n  this._parts = [];\r\n}\r\n\r\nBufferBuilder.prototype.append = function(data) {\r\n  if(typeof data === 'number') {\r\n    this._pieces.push(data);\r\n  } else {\r\n    this.flush();\r\n    this._parts.push(data);\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.flush = function() {\r\n  if (this._pieces.length > 0) {\r\n    var buf = new Uint8Array(this._pieces);\r\n    if(!binaryFeatures.useArrayBufferView) {\r\n      buf = buf.buffer;\r\n    }\r\n    this._parts.push(buf);\r\n    this._pieces = [];\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.getBuffer = function() {\r\n  this.flush();\r\n  if(binaryFeatures.useBlobBuilder) {\r\n    var builder = new BlobBuilder();\r\n    for(var i = 0, ii = this._parts.length; i < ii; i++) {\r\n      builder.append(this._parts[i]);\r\n    }\r\n    return builder.getBlob();\r\n  } else {\r\n    return new Blob(this._parts);\r\n  }\r\n};\r\n\r\nmodule.exports.BufferBuilder = BufferBuilder;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/js-binarypack/lib/bufferbuilder.js\n// module id = 5\n// module chunks = 0","var util = require('./util');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\nvar RTCSessionDescription = require('./adapter').RTCSessionDescription;\nvar RTCIceCandidate = require('./adapter').RTCIceCandidate;\n\n/**\n * Manages all negotiations between Peers.\n */\nvar Negotiator = {\n  pcs: {\n    data: {},\n    media: {}\n  }, // type => {peerId: {pc_id: pc}}.\n  //providers: {}, // provider's id => providers (there may be multiple providers/client.\n  queue: [] // connections that are delayed due to a PC being in use.\n}\n\nNegotiator._idPrefix = 'pc_';\n\n/** Returns a PeerConnection object set up correctly (for data, media). */\nNegotiator.startConnection = function(connection, options) {\n  var pc = Negotiator._getPeerConnection(connection, options);\n\n  // Set the connection's PC.\n  connection.pc = connection.peerConnection = pc;\n\n  if (connection.type === 'media' && options._stream) {\n    // Add the stream.\n    pc.addStream(options._stream);\n  }\n\n  // What do we need to do now?\n  if (options.originator) {\n    if (connection.type === 'data') {\n      // Create the datachannel.\n      var config = {};\n      // Dropping reliable:false support, since it seems to be crashing\n      // Chrome.\n      /*if (util.supports.sctp && !options.reliable) {\n        // If we have canonical reliable support...\n        config = {maxRetransmits: 0};\n      }*/\n      // Fallback to ensure older browsers don't crash.\n      if (!util.supports.sctp) {\n        config = {reliable: options.reliable};\n      }\n      var dc = pc.createDataChannel(connection.label, config);\n      connection.initialize(dc);\n    }\n\n    if (!util.supports.onnegotiationneeded) {\n      //Negotiator._makeOffer(connection);\n      // firefox\n      setTimeout(function(){\n        Negotiator._makeOffer(connection);\n      }, 0);\n    }\n  } else {\n    Negotiator.handleSDP('OFFER', connection, options.sdp);\n  }\n}\n\nNegotiator._getPeerConnection = function(connection, options) {\n  if (!Negotiator.pcs[connection.type]) {\n    util.error(connection.type + ' is not a valid connection type. Maybe you overrode the `type` property somewhere.');\n  }\n\n  if (!Negotiator.pcs[connection.type][connection.peer]) {\n    Negotiator.pcs[connection.type][connection.peer] = {};\n  }\n  var peerConnections = Negotiator.pcs[connection.type][connection.peer];\n\n  var pc;\n  // Not multiplexing while FF and Chrome have not-great support for it.\n  /*if (options.multiplex) {\n    ids = Object.keys(peerConnections);\n    for (var i = 0, ii = ids.length; i < ii; i += 1) {\n      pc = peerConnections[ids[i]];\n      if (pc.signalingState === 'stable') {\n        break; // We can go ahead and use this PC.\n      }\n    }\n  } else */\n  if (options.pc) { // Simplest case: PC id already provided for us.\n    pc = Negotiator.pcs[connection.type][connection.peer][options.pc];\n  }\n\n  if (!pc || pc.signalingState !== 'stable') {\n    pc = Negotiator._startPeerConnection(connection);\n  }\n  return pc;\n}\n\n/*\nNegotiator._addProvider = function(provider) {\n  if ((!provider.id && !provider.disconnected) || !provider.socket.open) {\n    // Wait for provider to obtain an ID.\n    provider.on('open', function(id) {\n      Negotiator._addProvider(provider);\n    });\n  } else {\n    Negotiator.providers[provider.id] = provider;\n  }\n}*/\n\n\n/** Start a PC. */\nNegotiator._startPeerConnection = function(connection) {\n  util.log('Creating RTCPeerConnection.');\n\n  var id = Negotiator._idPrefix + util.randomToken();\n  var optional = {};\n\n  if (connection.type === 'data' && !util.supports.sctp) {\n    optional = {optional: [{RtpDataChannels: true}]};\n  } else if (connection.type === 'media') {\n    // Interop req for chrome.\n    optional = {optional: [{DtlsSrtpKeyAgreement: true}]};\n  }\n\n  var pc = new RTCPeerConnection(connection.provider.options.config, optional);\n  Negotiator.pcs[connection.type][connection.peer][id] = pc;\n\n  Negotiator._setupListeners(connection, pc, id);\n\n  return pc;\n}\n\n/** Set up various WebRTC listeners. */\nNegotiator._setupListeners = function(connection, pc, pc_id) {\n  var peerId = connection.peer;\n  var connectionId = connection.id;\n  var provider = connection.provider;\n\n  // ICE CANDIDATES.\n  util.log('Listening for ICE candidates.');\n  pc.onicecandidate = function(evt) {\n    var candidate = evt.candidate || evt;\n\n    if (!candidate || candidate.candidate === null) {\n      util.log('ICE candidates gathering complete for:', connection.peer);\n    } else {\n      util.log('Generated ICE candidate for:', connection.peer, candidate);\n      provider.socket.send({\n        type: 'CANDIDATE',\n        payload: {\n          candidate: {\n            sdpMid: candidate.sdpMid,\n            sdpMLineIndex: candidate.sdpMLineIndex,\n            candidate: candidate.candidate\n          },\n          type: connection.type,\n          connectionId: connection.id\n        },\n        dst: peerId\n      });\n    }\n  };\n\n  pc.oniceconnectionstatechange = function() {\n    switch (pc.iceConnectionState) {\n      case 'failed':\n        util.log('iceConnectionState is disconnected, closing connections to ' + peerId);\n        connection.close();\n        break;\n      case 'completed':\n        pc.onicecandidate = util.noop;\n        break;\n    }\n  };\n\n  // Fallback for older Chrome impls.\n  pc.onicechange = pc.oniceconnectionstatechange;\n\n  // ONNEGOTIATIONNEEDED\n  if (util.supports.onnegotiationneeded) {\n    util.log('Listening for `negotiationneeded`');\n    pc.onnegotiationneeded = function() {\n      util.log('`negotiationneeded` triggered');\n      // prevent error for FF42+\n      // Took measures Because the ignition timing of onnegotiationneeded has changed.\n      if (pc.signalingState == 'stable' && !connection.options.connectionId) {\n        //setTimeout(function(ev){\n          // prevent error for FF40. When callee, before handling remoteDescription, calling _makeOffer makes error\n          // cause localDescription set. Delaying calls make it fix above mismatch.\n        //  Negotiator._makeOffer(connection);\n        //}, 1);\n        Negotiator._makeOffer(connection);\n      } else {\n        util.log('onnegotiationneeded triggered when not stable. Is another connection being established?');\n      }\n    };\n  }\n\n  // DATACONNECTION.\n  util.log('Listening for data channel');\n  // Fired between offer and answer, so options should already be saved\n  // in the options hash.\n  pc.ondatachannel = function(evt) {\n    util.log('Received data channel');\n    var dc = evt.channel || evt;\n    var connection = provider.getConnection(peerId, connectionId);\n    connection.initialize(dc);\n  };\n\n  // MEDIACONNECTION.\n  util.log('Listening for remote stream');\n  pc.onaddstream = function(evt) {\n    util.log('Received remote stream');\n    var stream = evt.stream || evt;\n    var connection = provider.getConnection(peerId, connectionId);\n    // 10/10/2014: looks like in Chrome 38, onaddstream is triggered after\n    // setting the remote description. Our connection object in these cases\n    // is actually a DATA connection, so addStream fails.\n    // TODO: This is hopefully just a temporary fix. We should try to\n    // understand why this is happening.\n    if (connection.type === 'media') {\n      connection.addStream(stream);\n    }\n  };\n}\n\nNegotiator.cleanup = function(connection) {\n  util.log('Cleaning up PeerConnection to ' + connection.peer);\n\n  var pc = connection.pc;\n\n  if (!!pc && (pc.readyState !== 'closed' || pc.signalingState !== 'closed')) {\n    pc.close();\n    connection.pc = null;\n  }\n}\n\nNegotiator._makeOffer = function(connection) {\n  var pc = connection.pc;\n\n  if(!!pc.remoteDescription && !!pc.remoteDescription.type) return;\n\n  pc.createOffer(function(offer) {\n    util.log('Created offer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      offer.sdp = Reliable.higherBandwidthSDP(offer.sdp);\n    }\n\n    pc.setLocalDescription(offer, function() {\n      util.log('Set localDescription: offer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'OFFER',\n        payload: {\n          sdp: {\n            type: offer.type,\n            sdp: offer.sdp\n          },\n          type: connection.type,\n          label: connection.label,\n          connectionId: connection.id,\n          reliable: connection.reliable,\n          serialization: connection.serialization,\n          metadata: connection.metadata,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to createOffer, ', err);\n  }, connection.options.constraints);\n}\n\nNegotiator._makeAnswer = function(connection) {\n  var pc = connection.pc;\n\n  pc.createAnswer(function(answer) {\n    util.log('Created answer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      answer.sdp = Reliable.higherBandwidthSDP(answer.sdp);\n    }\n\n    pc.setLocalDescription(answer, function() {\n      util.log('Set localDescription: answer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'ANSWER',\n        payload: {\n          sdp: {\n            type: answer.type,\n            sdp: answer.sdp\n          },\n          type: connection.type,\n          connectionId: connection.id,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to create answer, ', err);\n  });\n}\n\n/** Handle an SDP. */\nNegotiator.handleSDP = function(type, connection, receivedSdp) {\n  var sdp = new RTCSessionDescription({\n    type: receivedSdp.type,\n    sdp: receivedSdp.sdp\n  });\n  var pc = connection.pc;\n\n  util.log('Setting remote description', sdp);\n  pc.setRemoteDescription(sdp, function() {\n    util.log('Set remoteDescription:', type, 'for:', connection.peer);\n\n    if (type === 'OFFER') {\n      Negotiator._makeAnswer(connection);\n    }\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to setRemoteDescription, ', err);\n  });\n}\n\n/** Handle a candidate. */\nNegotiator.handleCandidate = function(connection, ice) {\n/*change log*/\n  // if ice is empty, ignore\n  if (!ice) {\n    return;\n  }\n\n  var candidate = ice.candidate;\n  var sdpMLineIndex = ice.sdpMLineIndex;\n  //var sdpMid = ice.sdpMid;\n  connection.pc.addIceCandidate(new RTCIceCandidate({\n    sdpMLineIndex: sdpMLineIndex,\n    candidate: candidate\n  }));\n  util.log('Added ICE candidate for:', connection.peer);\n}\n\nmodule.exports = Negotiator;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/negotiator.js\n// module id = 6\n// module chunks = 0","/**\n * MultiParty.js\n *\n * SkyWay\n */\n\nconst EventEmitter = require('events').EventEmitter\nconst util = require('./util')\nconst Peer = require('skyway-peerjs')\n\nnavigator.getUserMedia_ = navigator.getUserMedia\n  || navigator.webkitGetUserMedia\n  || navigator.mozGetUserMedia;\n\nclass MultiParty extends EventEmitter {\n  constructor(opts) {\n    super();\n\n    this.room = null; // \n    this.id = null; // ID\n    this.key = null; // app key\n    this.peers = {}; // peer Objects\n    this.stream = null; // my media stream\n    this.tracks_ = {};\n    this.pollInterval = null;\n\n    this.opened = false;\n\n    // option \n    // room, myid, key \n    this.opts = util.checkOpts_(opts);\n  }\n\n  // SkyWay\n  conn2SkyWay_() {\n    var self = this;\n\n\n    this.peer = new Peer(this.opts.id, this.opts.peerjs_opts);\n\n    // SkyWayopen \n    this.peer.on('open', function(id) {\n      if(this.opened) {\n        throw \"Error : connection to SkyWay is already opened\";\n      } else {\n        this.opened = true;\n      }\n\n      // id check\n      if(id !== this.opts.id) {\n        throw \"Error : SkyWay returns wrong peer id for myself\";\n      }\n\n      // open \n      this.fire_('open', id);\n\n      // ID\n      this.getIDs_();\n\n      // polling\n      if(this.opts.polling) {\n        this.startPollingConnections_();\n      }\n    }.bind(this));\n\n    // SkyWayerror\n    this.peer.on(\"error\", function(err) {\n      self.fire_('error', err)\n    });\n  }\n\n  // ID\n  getIDs_() {\n    var self = this;\n\n    self.listAllPeers(function(peers){\n      peers.forEach(function(peer_id){\n        self.peers[peer_id] = {};\n      });\n\n      // MediaStream\n      if(self.opts.use_stream) {\n        self.startMediaStream_();\n      }\n\n      // DataChannel\n      self.startDataChannel_();\n    });\n  }\n\n  // IDID\n  startPollingConnections_(){\n    var self = this;\n    self.pollInterval = setInterval(function(){\n      self.listAllPeers(function(newList){\n        for(var peer_id in self.peers){\n          var removeId = true;\n          if(peer_id === undefined) {\n            return;\n          }\n          $.each(newList, function(j, peerId){\n            if(peer_id === peerId) {\n            removeId = false;\n            }\n          });\n          if(removeId) {\n            self.removePeer(peer_id);\n          } else {\n            var peer = self.peers[peer_id];\n            var reconnect = {\n              video: peer.call?!peer.call.open:false,\n              screen: peer.screen_sender?!peer.screen_sender.open:false,\n              data: peer.DCconn?!peer.DCconn.open:false\n            };\n            if(reconnect.video || reconnect.screen || reconnect.data) {\n              if(!peer.reconnectIndex_){\n                peer.reconnectIndex_ = 1;\n              } else {\n                peer.reconnectIndex_++;\n              }\n              // reconnect on powers of 2 minus (1, 2, 4, 8 ...)\n              if((peer.reconnectIndex_ & (peer.reconnectIndex_-1)) == 0){\n                self.reconnect(peer_id, reconnect);\n              }\n            } else {\n              peer.reconnectIndex_ = 0;\n            }\n          }\n        };\n      })\n    }, self.opts.polling_interval);\n  }\n\n  ////////////////////////////////////\n  // video \n\n  // Media Stream \n  startMediaStream_(){\n    this.startMyStream_();\n  }\n\n  // video stream \n  startMyStream_() {\n    var self = this;\n\n    navigator.getUserMedia_({\"video\": self.opts.video_stream, \"audio\": self.opts.audio_stream},\n      function(stream) {\n        if(self.opts.audio_stream){\n          self.tracks_.audio = stream.getAudioTracks()[0];\n        }\n\n        if(self.opts.video_stream){\n          self.tracks_.video = stream.getVideoTracks()[0];\n        }\n\n        self.stream = stream;\n\n        self.fire_('my_ms', {\"src\": URL.createObjectURL(self.stream), \"id\": self.opts.id});\n        self.startCall_();\n\n      }, function(err) {\n        self.fire_('error', err)\n      }\n    );\n  }\n\n  // mute either media and audio track\n  //\n  //\n  // snipet.\n  // ```\n  // multiparty.mute({audio: true});  // only audio becomes mute, so callee becomes not to hear about caller voice.\n  // ```\n  mute(target_track /* {\"video\": boolean, \"audio\": boolean} */) {\n    // if parameter **target_track** does not proper value. We forcibly set both mute.\n    if( typeof(target_track) !== \"object\" ) { target_track = {video:true, audio:true}; }\n\n    // make each stream mute based on parameter\n    if( typeof(target_track.audio) !== \"undefined\" ) { this.tracks_.audio.enabled = !target_track.audio; }\n    if( typeof(target_track.video) !== \"undefined\" ) { this.tracks_.video.enabled = !target_track.video; }\n  };\n\n  // unmute either media and audio track\n  //\n  //\n  // snipet.\n  // ```\n  // multiparty.unmute({audio: true});  // only audio becomes unmute, so caller's face cannot be seen from callee side.\n  // ```\n  unmute(target_track /* {\"video\": boolean, \"audio\": boolean} */) {\n    // if parameter **target_track** does not proper value. We forcibly set both unmute.\n    if( typeof(target_track) !== \"object\") { target_track = {video:true, audio:true}; }\n\n    // make each stream unmute based on parameter\n    if( typeof(target_track.audio) !== \"undefined\") { this.tracks_.audio.enabled = !!target_track.audio; }\n    if( typeof(target_track.video) !== \"undefined\") { this.tracks_.video.enabled = !!target_track.video; }\n  };\n\n\n  // peersMediaStream call\n  startCall_(isScreen) {\n    var self = this;\n\n    // APIIDcallcaller\n    for( var peer_id in this.peers) {\n      (function(self){\n        if(isScreen === true) {\n          if(!self.peers[peer_id].screen_sender || self.peers[peer_id].screen_sender.open) {\n            var call = self.peer.call(\n                peer_id,\n                self.screenStream,\n                {metadata:{type:'screen'}}\n            );\n            console.log(\"peer.call called from screenshare startCall_\");\n            self.peers[peer_id].screen_sender = call;\n            self.setupStreamHandler_(call);\n          }\n        } else {\n          var call = self.peer.call(\n              peer_id,\n              self.stream\n          );\n          console.log(\"peer.call called from generic media exchange startCall_\");\n          self.peers[peer_id].call = call;\n          self.setupStreamHandler_(call);\n        }\n      }(self));\n    };\n\n\n    // peercall\n    if(!this.peer._events.call || this.peer._events.call.length === 0) {\n      this.peer.on('call', function(call) {\n        if(!self.peers[call.peer]) {\n          self.peers[call.peer] = {};\n        }\n        if(call.metadata && call.metadata.type === 'screen') {\n          self.peers[call.peer].screen_receiver = call;\n          call.answer();\n          self.setupStreamHandler_(call);\n        } else {\n          self.peers[call.peer].call = call;\n          call.answer(self.stream);\n          self.setupStreamHandler_(call);\n          if(self.screenStream !== undefined){\n            var call = self.peer.call(\n                call.peer,\n                self.screenStream,\n                {metadata:{type:'screen'}}\n            );\n            self.peers[call.peer].screen_sender = call;\n          }\n          console.log(\"peer.call called from call callback\");\n        }\n      });\n    }\n  }\n\n  // peervideo stream, close\n  setupStreamHandler_(call) {\n    var self = this;\n    var isReconnect = !!(call.metadata && call.metadata.reconnect);\n\n    call.on('stream', function(stream) {\n      if(call.metadata && call.metadata.type === 'screen') {\n        self.peers[this.peer].screen_receiver.stream = stream;\n        self.setupPeerScreen_(this.peer, stream, isReconnect);\n      } else {\n        self.peers[this.peer].call.stream = stream;\n        self.setupPeerVideo_(this.peer, stream, isReconnect);\n      }\n\n    }).on('close', function(){\n      // handle peer close event\n      // check skyway server to see this user is disconnected.\n\n\n      var peer_id = this.peer;\n      var metadata = this.metadata;\n      var isScreenShare = !!(metadata && metadata.type === 'screen');\n      var isSSCaller =\n        (self.peers[this.peer].screen_sender &&\n         self.peers[this.peer].screen_sender.id === this.id);\n      self.listAllPeers(function(list){\n          var isDisconnected = true;\n          for(var index in list) {\n              if(list[index] === peer_id) {\n                  isDisconnected = false;\n                  break;\n              }\n          }\n          if(isDisconnected || isScreenShare){\n              if(isScreenShare) {\n                  // don't emit ss_close if you're the sender\n                  if (!isSSCaller) {\n                    self.fire_('ss_close', peer_id);\n                  }\n              } else {\n                  self.fire_('ms_close', peer_id);\n              }\n              // check if user has any other open connections\n              if(self.peers[peer_id] &&\n                (self.peers[peer_id].call === undefined || !self.peers[peer_id].call.open) &&\n                (self.peers[peer_id].DCconn === undefined || !self.peers[peer_id].DCconn.open) &&\n                (self.peers[peer_id].screen_sender === undefined || !self.peers[peer_id].screen_sender.open)) {\n                  self.removePeer(peer_id);\n              }\n          } else {\n              // leave reconnecting up to startPollingConnections_\n          }\n      });\n    });\n  }\n\n  // peervideoObjectURLfrontpeer_ms\n  setupPeerVideo_(peer_id, stream, isReconnect) {\n    // prevent to call twice.\n    // if(!!this.peers[peer_id].video) return;\n\n    var url = window.URL.createObjectURL(stream);\n\n    // set isReconnect as boolean\n    isReconnect = !!isReconnect;\n\n    this.peers[peer_id].video = stream;\n    this.fire_('peer_ms', {id: peer_id, src: url, reconnect: isReconnect});\n  }\n\n  // peervideo Node\n  // loadedmetadata'peer_video'fire\n  setupPeerScreen_(peer_id, stream, isReconnect) {\n    var self = this;\n    if(!isReconnect){\n      isReconnect = false;\n    }\n\n    self.peers[peer_id].screen_receiver.video = stream;\n    self.fire_('peer_ss', {src: URL.createObjectURL(stream), id: peer_id, reconnect: isReconnect});\n  }\n\n  // peerdcmc\n  removePeer(peer_id) {\n    try{\n      if(this.peers[peer_id] !== undefined) {\n        var peer = this.peers[peer_id];\n        if(peer.call) {\n          peer.call.close();\n        }\n        if(peer.screen_sender) {\n          peer.screen_sender.close();\n        }\n        if(peer.screen_receiver) {\n          peer.screen_receiver.close();\n        }\n        if(peer.DCconn) {\n          peer.DCconn.close();\n        }\n      }\n    } finally {\n      delete this.peers[peer_id];\n    }\n  }\n\n\n  //////////////////////////////////\n  // DataChannel \n\n  // DataChannel \n  startDataChannel_(){\n    this.startDCconnection_();\n  }\n\n  // DataChannel\n  startDCconnection_(){\n    var self = this;\n\n    // APIIDconnect\n    for ( var peer_id in this.peers ) {\n      this.DCconnect_(peer_id);\n    }\n\n    //peerconnection\n    this.peer.on('connection', function(conn) {\n      if(!self.peers[conn.peer]) {\n        self.peers[conn.peer] = {};\n      }\n      self.peers[conn.peer].DCconn = conn;\n\n      self.setupDCHandler_(conn);\n      self.fire_('dc_open', conn.peer);\n    });\n  }\n\n  // DataChannel\n  DCconnect_(peer_id){\n    var conn = this.peer.connect(peer_id, {\"serialization\": this.opts.serialization, \"reliable\": this.opts.reliable});\n    this.peers[peer_id].DCconn = conn;\n\n    conn.on('open', function() {\n      this.setupDCHandler_(conn);\n      this.fire_('dc_open', conn.peer);\n    }.bind(this));\n  }\n\n  // DataChannel\n  setupDCHandler_(conn) {\n    var self = this;\n    conn.on('data', function(data) {\n      self.fire_('message', {\"id\": this.peer, \"data\": data});\n    }).on('close', function() {\n      // handle peer close event\n      // check skyway server to see this user is disconnected.\n      var peer_id = this.peer;\n      self.listAllPeers(function(list) {\n        var isDisconnected = true;\n        for (var index in list) {\n          if (list[index] === peer_id) {\n            isDisconnected = false;\n            break;\n          }\n        }\n        if(isDisconnected){\n          self.fire_('dc_close', peer_id);\n          // check if user has any other open connections\n          if(self.peers[peer_id] &&\n            (self.peers[peer_id].call === undefined || !self.peers[peer_id].call.open) &&\n            (self.peers[peer_id].DCconn === undefined || !self.peers[peer_id].DCconn.open) &&\n            (self.peers[peer_id].screen_sender === undefined || !self.peers[peer_id].screen_sender.open)) {\n            self.removePeer(peer_id);\n          }\n        } else {\n          // leave reconnecting up to startPollingConnections_\n        }\n      });\n    });\n  }\n\n  // DataChannelpeer\n  send_(data) {\n    if(!this.peer) {\n      return false;\n    }\n\n    if(data && typeof(data) === \"string\" && data.length === 0) {\n      return false;\n    }\n\n    if(data && (typeof(data) === \"string\" || typeof(data) === \"object\")) {\n      for(var peer_id in this.peers) if(this.peers[peer_id].DCconn) {\n        this.peers[peer_id].DCconn.send(data);\n      }\n    }\n  }\n\n  // \n  fire_(name, obj) {\n    this.emit(name, obj);\n  }\n\n  ////////////////////////////////////\n  // public method\n\n  start() {\n    var self = this;\n    setTimeout(function(){\n      self.conn2SkyWay_();\n    }, 0);\n    return self;\n  }\n\n  send(data) {\n    if(this.peer) this.send_(data);\n  }\n\n  // \n  close() {\n    if(this.peer) this.peer.destroy();\n    clearInterval(this.pollInterval);\n  }\n\n  // \n  startScreenShare(success, error) {\n      if(this.peer) {\n          var self = this;\n          if(SkyWay && SkyWay.ScreenShare) {\n              var sc = new SkyWay.ScreenShare();\n              if(sc.isEnabledExtension()) {\n                  sc.startScreenShare({\n                      Width: screen.width,\n                      Height: screen.height,\n                      FrameRate: 5\n                  },function (stream){\n                      self.screenStream = stream;\n                      self.startCall_(true);\n                      util.log(\"MediaConnection created in OFFER\");\n\n                      //callback use video\n                      success(stream);\n                  }, error);\n              }\n          }\n      }\n  }\n\n\n  // \n  stopScreenShare() {\n    if(this.screenStream){\n      this.screenStream.getVideoTracks()[0].stop();\n      for(var peer_id in this.peers){\n        if(this.peers[peer_id].screen_sender) {\n          this.peers[peer_id].screen_sender.close()\n        }\n        delete this.peers[peer_id].screen_sender;\n      }\n    this.screenStream = undefined;\n    }\n  }\n\n  // Roompeer list\n  listAllPeers(callback) {\n    var self = this;\n    this.peer.listAllPeers(\n      function(peers){\n        var roomPeers = [];\n        peers.forEach(function(peer_id) {\n          // peer_ididpeer_idroom_id\n          if(peer_id !== self.opts.id && peer_id.indexOf(self.opts.room_id) === 0) {\n            roomPeers.push(peer_id);\n          }\n        });\n        callback(roomPeers);\n      });\n  }\n\n  // \n  reconnect(peer_id, connections) {\n    var self = this;\n    var peer = self.peers[peer_id];\n    if(connections === undefined) {\n      connections = {\n        video: true,\n        screen: true,\n        data: true\n      }\n    }\n    if(peer) {\n      if(connections.video) {\n        if(peer.call && peer.call.close){\n          peer.call.close();\n        }\n        var call = self.peer.call(\n            peer_id,\n            self.stream,\n            {metadata: {reconnect: true}}\n        );\n\n        console.log(\"peer.call called from reconnect method\");\n        peer.call = call;\n        self.setupStreamHandler_(call);\n      }\n      if(connections.screen) {\n        if(self.screenStream) {\n          if(peer.screen_sender && peer.screen_sender.close){\n            peer.screen_sender.close();\n          }\n          var call = self.peer.call(\n              peer_id,\n              self.screenStream,\n              {metadata: {reconnect: true, type: 'screen'}}\n          );\n          console.log(\"peer.call called from reconnect method in screenshare\");\n          peer.screen_sender = call;\n        }\n      }\n      if(connections.data) {\n        if(peer.DCconn && peer.DCconn.close){\n          peer.DCconn.close();\n        }\n        var conn = this.peer.connect(peer_id,\n          {\n            \"serialization\": this.opts.serialization,\n            \"reliable\": this.opts.reliable,\n            \"metadata\": {reconnect: true}\n          }\n        ).on('open', function(){\n          peer.DCconn = conn;\n          self.setupDCHandler_(conn);\n        });\n      }\n    }\n  }\n}\n\nMultiParty.util = util;\n\nmodule.exports = MultiParty;\n\n\n\n\n// WEBPACK FOOTER //\n// ./lib/MultiParty.js","module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/module.js\n// module id = 8\n// module chunks = 0","const MultiParty = require(\"./MultiParty\")\n\nif(module.require) {\n  module.exports = MultiParty;\n} else {\n  window.MultiParty = MultiParty;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/index.js","/////////////////////////////////////\n// utility\nconst md5 = require('md5')\n\nconst util = {};\n\n// \nutil.checkOpts_ = function(opts_) {\n  var opts = {};\n\n  // key check ( throw)\n  if(!opts_.key || typeof(opts_.key) !== \"string\") {\n    throw \"app key must be specified\";\n  };\n\n  // key check ( string patter  throw )\n  if(!opts_.key.match(/^[0-9a-z]{8}\\-[0-9a-z]{4}\\-[0-9a-z]{4}\\-[0-9a-z]{4}\\-[0-9a-z]{12}$/)) {\n    throw \"wrong string pattern of app key\";\n  };\n  // copy key\n  opts.key = opts_.key;\n\n  // todo : room prefix domain\n  // room check ( \"\")\n  if(!opts_.room || typeof(opts_.room) !== \"string\") {\n    var seed = \"\";\n  } else if(!opts_.room.match(/^[0-9a-zA-Z\\-\\_]{4,32}$/)){\n    throw \"room name should be digit|alphabet and length between 4 and 32\";\n  } else {\n    var seed = opts_.room\n  };\n\n  opts.room_name = seed;\n\n  opts.room_id = util.makeRoomName(seed);\n\n  // id check (\n\n  var hash_ = location.pathname + \"_\" + opts.room_id + \"_peer_id\";\n  if(!!sessionStorage[hash_]) {\n    opts.id = sessionStorage[hash_];\n  } else if(!opts_.id || typeof(opts_.id) !== \"string\") {\n    opts.id = opts.room_id + util.makeID();\n  } else {\n    opts.id = opts.room_id + opts_.id;\n  }\n  sessionStorage[hash_] = opts.id;\n\n  // reliable check ( false)\n  if(!opts_.reliable) {\n    opts.reliable = false;\n  } else {\n    opts.reliable = true;\n  }\n\n  // serialization check ( binary)\n  if(!opts_.serialization) {\n    opts.serialization = \"binary\";\n  } else {\n    // serialization\n    // binary, utf-8, json\n    opts.serialization = opts_.serialization;\n  }\n\n  // stream check\n  opts.video_stream = (opts_.video === undefined ? true : opts_.video);\n  opts.audio_stream = (opts_.audio === undefined ? true : opts_.audio);\n  opts.use_stream = opts.video_stream || opts.audio_stream;\n\n  // polling disconnect/reconnect (must for FF)\n  opts.polling = (opts_.polling === undefined ? true : opts_.polling);\n  opts.polling_interval = (opts_.polling_interval === undefined ? 3000 : opts_.polling_interval);\n\n  // peerjs options\n  opts.peerjs_opts = {\n    debug: opts_.debug || false,\n    key: opts.key\n  };\n  if(opts_.host){\n    opts.peerjs_opts.host = opts_.host;\n  }\n  if(opts_.port){\n      opts.peerjs_opts.port = opts_.port;\n  }\n  if(opts_.secure){\n    opts.peerjs_opts.secure = opts_.secure;\n  }\n  if(opts_.config){\n    opts.peerjs_opts.config = opts_.config;\n  }\n\n  return opts;\n}\n\n\n\n// ID\nutil.makeID = function() {\n  var id = \"\";\n\n  for (var i = 0; i < 32; i++) {\n    // id += String.fromCharCode( (Math.random() * (125 - 33) + 33) | 0)\n    id += String.fromCharCode( (Math.random() * (57 - 48) + 48) | 0)\n  }\n  return id;\n}\n\n// room\nutil.makeRoomName = function(seed) {\n    seed = seed || \"\";\n    seed += location.host + location.pathname;\n    return md5(seed).substring(0,6) + \"R_\";\n}\n\n// video node\nutil.createVideoNode = function(video) {\n  // \n  var prev_node = document.getElementById(video.id);\n  if(prev_node) prev_node.parentNode.removeChild(prev_node);\n\n  // \n  var v_ = document.createElement(\"video\");\n  v_.setAttribute(\"src\", video.src);\n  v_.setAttribute(\"id\", video.id);\n\n  var played = false;\n\n  v_.addEventListener(\"loadedmetadata\", function(ev) {\n    if(!played) {\n      played = true;\n      this.play();\n    }\n  }, false);\n\n  // since FF37 sometimes doesn't fire \"loadedmetadata\"\n  // work around is after 500msec, calling play();\n  setTimeout(function(ev){\n    if(!played) {\n      played = true;\n      v_.play();\n    }\n  }, 500);\n\n  return v_;\n}\n\n\nmodule.exports = util\n\n\n\n// WEBPACK FOOTER //\n// ./lib/util.js","(function() {\n  var base64map\n      = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',\n\n  crypt = {\n    // Bit-wise rotation left\n    rotl: function(n, b) {\n      return (n << b) | (n >>> (32 - b));\n    },\n\n    // Bit-wise rotation right\n    rotr: function(n, b) {\n      return (n << (32 - b)) | (n >>> b);\n    },\n\n    // Swap big-endian to little-endian and vice versa\n    endian: function(n) {\n      // If number given, swap endian\n      if (n.constructor == Number) {\n        return crypt.rotl(n, 8) & 0x00FF00FF | crypt.rotl(n, 24) & 0xFF00FF00;\n      }\n\n      // Else, assume array and swap all items\n      for (var i = 0; i < n.length; i++)\n        n[i] = crypt.endian(n[i]);\n      return n;\n    },\n\n    // Generate an array of any length of random bytes\n    randomBytes: function(n) {\n      for (var bytes = []; n > 0; n--)\n        bytes.push(Math.floor(Math.random() * 256));\n      return bytes;\n    },\n\n    // Convert a byte array to big-endian 32-bit words\n    bytesToWords: function(bytes) {\n      for (var words = [], i = 0, b = 0; i < bytes.length; i++, b += 8)\n        words[b >>> 5] |= bytes[i] << (24 - b % 32);\n      return words;\n    },\n\n    // Convert big-endian 32-bit words to a byte array\n    wordsToBytes: function(words) {\n      for (var bytes = [], b = 0; b < words.length * 32; b += 8)\n        bytes.push((words[b >>> 5] >>> (24 - b % 32)) & 0xFF);\n      return bytes;\n    },\n\n    // Convert a byte array to a hex string\n    bytesToHex: function(bytes) {\n      for (var hex = [], i = 0; i < bytes.length; i++) {\n        hex.push((bytes[i] >>> 4).toString(16));\n        hex.push((bytes[i] & 0xF).toString(16));\n      }\n      return hex.join('');\n    },\n\n    // Convert a hex string to a byte array\n    hexToBytes: function(hex) {\n      for (var bytes = [], c = 0; c < hex.length; c += 2)\n        bytes.push(parseInt(hex.substr(c, 2), 16));\n      return bytes;\n    },\n\n    // Convert a byte array to a base-64 string\n    bytesToBase64: function(bytes) {\n      for (var base64 = [], i = 0; i < bytes.length; i += 3) {\n        var triplet = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2];\n        for (var j = 0; j < 4; j++)\n          if (i * 8 + j * 6 <= bytes.length * 8)\n            base64.push(base64map.charAt((triplet >>> 6 * (3 - j)) & 0x3F));\n          else\n            base64.push('=');\n      }\n      return base64.join('');\n    },\n\n    // Convert a base-64 string to a byte array\n    base64ToBytes: function(base64) {\n      // Remove non-base-64 characters\n      base64 = base64.replace(/[^A-Z0-9+\\/]/ig, '');\n\n      for (var bytes = [], i = 0, imod4 = 0; i < base64.length;\n          imod4 = ++i % 4) {\n        if (imod4 == 0) continue;\n        bytes.push(((base64map.indexOf(base64.charAt(i - 1))\n            & (Math.pow(2, -2 * imod4 + 8) - 1)) << (imod4 * 2))\n            | (base64map.indexOf(base64.charAt(i)) >>> (6 - imod4 * 2)));\n      }\n      return bytes;\n    }\n  };\n\n  module.exports = crypt;\n})();\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/crypt/crypt.js\n// module id = 11\n// module chunks = 0","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 12\n// module chunks = 0","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\n// The _isBuffer check is for Safari 5-7 support, because it's missing\n// Object.prototype.constructor. Remove this eventually\nmodule.exports = function (obj) {\n  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)\n}\n\nfunction isBuffer (obj) {\n  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n\n// For Node v0.10 support. Remove this eventually.\nfunction isSlowBuffer (obj) {\n  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/is-buffer/index.js\n// module id = 13\n// module chunks = 0","(function(){\r\n  var crypt = require('crypt'),\r\n      utf8 = require('charenc').utf8,\r\n      isBuffer = require('is-buffer'),\r\n      bin = require('charenc').bin,\r\n\r\n  // The core\r\n  md5 = function (message, options) {\r\n    // Convert to byte array\r\n    if (message.constructor == String)\r\n      if (options && options.encoding === 'binary')\r\n        message = bin.stringToBytes(message);\r\n      else\r\n        message = utf8.stringToBytes(message);\r\n    else if (isBuffer(message))\r\n      message = Array.prototype.slice.call(message, 0);\r\n    else if (!Array.isArray(message))\r\n      message = message.toString();\r\n    // else, assume byte array already\r\n\r\n    var m = crypt.bytesToWords(message),\r\n        l = message.length * 8,\r\n        a =  1732584193,\r\n        b = -271733879,\r\n        c = -1732584194,\r\n        d =  271733878;\r\n\r\n    // Swap endian\r\n    for (var i = 0; i < m.length; i++) {\r\n      m[i] = ((m[i] <<  8) | (m[i] >>> 24)) & 0x00FF00FF |\r\n             ((m[i] << 24) | (m[i] >>>  8)) & 0xFF00FF00;\r\n    }\r\n\r\n    // Padding\r\n    m[l >>> 5] |= 0x80 << (l % 32);\r\n    m[(((l + 64) >>> 9) << 4) + 14] = l;\r\n\r\n    // Method shortcuts\r\n    var FF = md5._ff,\r\n        GG = md5._gg,\r\n        HH = md5._hh,\r\n        II = md5._ii;\r\n\r\n    for (var i = 0; i < m.length; i += 16) {\r\n\r\n      var aa = a,\r\n          bb = b,\r\n          cc = c,\r\n          dd = d;\r\n\r\n      a = FF(a, b, c, d, m[i+ 0],  7, -680876936);\r\n      d = FF(d, a, b, c, m[i+ 1], 12, -389564586);\r\n      c = FF(c, d, a, b, m[i+ 2], 17,  606105819);\r\n      b = FF(b, c, d, a, m[i+ 3], 22, -1044525330);\r\n      a = FF(a, b, c, d, m[i+ 4],  7, -176418897);\r\n      d = FF(d, a, b, c, m[i+ 5], 12,  1200080426);\r\n      c = FF(c, d, a, b, m[i+ 6], 17, -1473231341);\r\n      b = FF(b, c, d, a, m[i+ 7], 22, -45705983);\r\n      a = FF(a, b, c, d, m[i+ 8],  7,  1770035416);\r\n      d = FF(d, a, b, c, m[i+ 9], 12, -1958414417);\r\n      c = FF(c, d, a, b, m[i+10], 17, -42063);\r\n      b = FF(b, c, d, a, m[i+11], 22, -1990404162);\r\n      a = FF(a, b, c, d, m[i+12],  7,  1804603682);\r\n      d = FF(d, a, b, c, m[i+13], 12, -40341101);\r\n      c = FF(c, d, a, b, m[i+14], 17, -1502002290);\r\n      b = FF(b, c, d, a, m[i+15], 22,  1236535329);\r\n\r\n      a = GG(a, b, c, d, m[i+ 1],  5, -165796510);\r\n      d = GG(d, a, b, c, m[i+ 6],  9, -1069501632);\r\n      c = GG(c, d, a, b, m[i+11], 14,  643717713);\r\n      b = GG(b, c, d, a, m[i+ 0], 20, -373897302);\r\n      a = GG(a, b, c, d, m[i+ 5],  5, -701558691);\r\n      d = GG(d, a, b, c, m[i+10],  9,  38016083);\r\n      c = GG(c, d, a, b, m[i+15], 14, -660478335);\r\n      b = GG(b, c, d, a, m[i+ 4], 20, -405537848);\r\n      a = GG(a, b, c, d, m[i+ 9],  5,  568446438);\r\n      d = GG(d, a, b, c, m[i+14],  9, -1019803690);\r\n      c = GG(c, d, a, b, m[i+ 3], 14, -187363961);\r\n      b = GG(b, c, d, a, m[i+ 8], 20,  1163531501);\r\n      a = GG(a, b, c, d, m[i+13],  5, -1444681467);\r\n      d = GG(d, a, b, c, m[i+ 2],  9, -51403784);\r\n      c = GG(c, d, a, b, m[i+ 7], 14,  1735328473);\r\n      b = GG(b, c, d, a, m[i+12], 20, -1926607734);\r\n\r\n      a = HH(a, b, c, d, m[i+ 5],  4, -378558);\r\n      d = HH(d, a, b, c, m[i+ 8], 11, -2022574463);\r\n      c = HH(c, d, a, b, m[i+11], 16,  1839030562);\r\n      b = HH(b, c, d, a, m[i+14], 23, -35309556);\r\n      a = HH(a, b, c, d, m[i+ 1],  4, -1530992060);\r\n      d = HH(d, a, b, c, m[i+ 4], 11,  1272893353);\r\n      c = HH(c, d, a, b, m[i+ 7], 16, -155497632);\r\n      b = HH(b, c, d, a, m[i+10], 23, -1094730640);\r\n      a = HH(a, b, c, d, m[i+13],  4,  681279174);\r\n      d = HH(d, a, b, c, m[i+ 0], 11, -358537222);\r\n      c = HH(c, d, a, b, m[i+ 3], 16, -722521979);\r\n      b = HH(b, c, d, a, m[i+ 6], 23,  76029189);\r\n      a = HH(a, b, c, d, m[i+ 9],  4, -640364487);\r\n      d = HH(d, a, b, c, m[i+12], 11, -421815835);\r\n      c = HH(c, d, a, b, m[i+15], 16,  530742520);\r\n      b = HH(b, c, d, a, m[i+ 2], 23, -995338651);\r\n\r\n      a = II(a, b, c, d, m[i+ 0],  6, -198630844);\r\n      d = II(d, a, b, c, m[i+ 7], 10,  1126891415);\r\n      c = II(c, d, a, b, m[i+14], 15, -1416354905);\r\n      b = II(b, c, d, a, m[i+ 5], 21, -57434055);\r\n      a = II(a, b, c, d, m[i+12],  6,  1700485571);\r\n      d = II(d, a, b, c, m[i+ 3], 10, -1894986606);\r\n      c = II(c, d, a, b, m[i+10], 15, -1051523);\r\n      b = II(b, c, d, a, m[i+ 1], 21, -2054922799);\r\n      a = II(a, b, c, d, m[i+ 8],  6,  1873313359);\r\n      d = II(d, a, b, c, m[i+15], 10, -30611744);\r\n      c = II(c, d, a, b, m[i+ 6], 15, -1560198380);\r\n      b = II(b, c, d, a, m[i+13], 21,  1309151649);\r\n      a = II(a, b, c, d, m[i+ 4],  6, -145523070);\r\n      d = II(d, a, b, c, m[i+11], 10, -1120210379);\r\n      c = II(c, d, a, b, m[i+ 2], 15,  718787259);\r\n      b = II(b, c, d, a, m[i+ 9], 21, -343485551);\r\n\r\n      a = (a + aa) >>> 0;\r\n      b = (b + bb) >>> 0;\r\n      c = (c + cc) >>> 0;\r\n      d = (d + dd) >>> 0;\r\n    }\r\n\r\n    return crypt.endian([a, b, c, d]);\r\n  };\r\n\r\n  // Auxiliary functions\r\n  md5._ff  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b & c | ~b & d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._gg  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b & d | c & ~d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._hh  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b ^ c ^ d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._ii  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (c ^ (b | ~d)) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n\r\n  // Package private blocksize\r\n  md5._blocksize = 16;\r\n  md5._digestsize = 16;\r\n\r\n  module.exports = function (message, options) {\r\n    if (message === undefined || message === null)\r\n      throw new Error('Illegal argument ' + message);\r\n\r\n    var digestbytes = crypt.wordsToBytes(md5(message, options));\r\n    return options && options.asBytes ? digestbytes :\r\n        options && options.asString ? bin.bytesToString(digestbytes) :\r\n        crypt.bytesToHex(digestbytes);\r\n  };\r\n\r\n})();\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/md5/md5.js\n// module id = 14\n// module chunks = 0","var util = require('./util');\n\n/**\n * Reliable transfer for Chrome Canary DataChannel impl.\n * Author: @michellebu\n */\nfunction Reliable(dc, debug) {\n  if (!(this instanceof Reliable)) return new Reliable(dc);\n  this._dc = dc;\n\n  util.debug = debug;\n\n  // Messages sent/received so far.\n  // id: { ack: n, chunks: [...] }\n  this._outgoing = {};\n  // id: { ack: ['ack', id, n], chunks: [...] }\n  this._incoming = {};\n  this._received = {};\n\n  // Window size.\n  this._window = 1000;\n  // MTU.\n  this._mtu = 500;\n  // Interval for setInterval. In ms.\n  this._interval = 0;\n\n  // Messages sent.\n  this._count = 0;\n\n  // Outgoing message queue.\n  this._queue = [];\n\n  this._setupDC();\n};\n\n// Send a message reliably.\nReliable.prototype.send = function(msg) {\n  // Determine if chunking is necessary.\n  var bl = util.pack(msg);\n  if (bl.size < this._mtu) {\n    this._handleSend(['no', bl]);\n    return;\n  }\n\n  this._outgoing[this._count] = {\n    ack: 0,\n    chunks: this._chunk(bl)\n  };\n\n  if (util.debug) {\n    this._outgoing[this._count].timer = new Date();\n  }\n\n  // Send prelim window.\n  this._sendWindowedChunks(this._count);\n  this._count += 1;\n};\n\n// Set up interval for processing queue.\nReliable.prototype._setupInterval = function() {\n  // TODO: fail gracefully.\n\n  var self = this;\n  this._timeout = setInterval(function() {\n    // FIXME: String stuff makes things terribly async.\n    var msg = self._queue.shift();\n    if (msg._multiple) {\n      for (var i = 0, ii = msg.length; i < ii; i += 1) {\n        self._intervalSend(msg[i]);\n      }\n    } else {\n      self._intervalSend(msg);\n    }\n  }, this._interval);\n};\n\nReliable.prototype._intervalSend = function(msg) {\n  var self = this;\n  msg = util.pack(msg);\n  util.blobToBinaryString(msg, function(str) {\n    self._dc.send(str);\n  });\n  if (self._queue.length === 0) {\n    clearTimeout(self._timeout);\n    self._timeout = null;\n    //self._processAcks();\n  }\n};\n\n// Go through ACKs to send missing pieces.\nReliable.prototype._processAcks = function() {\n  for (var id in this._outgoing) {\n    if (this._outgoing.hasOwnProperty(id)) {\n      this._sendWindowedChunks(id);\n    }\n  }\n};\n\n// Handle sending a message.\n// FIXME: Don't wait for interval time for all messages...\nReliable.prototype._handleSend = function(msg) {\n  var push = true;\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    var item = this._queue[i];\n    if (item === msg) {\n      push = false;\n    } else if (item._multiple && item.indexOf(msg) !== -1) {\n      push = false;\n    }\n  }\n  if (push) {\n    this._queue.push(msg);\n    if (!this._timeout) {\n      this._setupInterval();\n    }\n  }\n};\n\n// Set up DataChannel handlers.\nReliable.prototype._setupDC = function() {\n  // Handle various message types.\n  var self = this;\n  this._dc.onmessage = function(e) {\n    var msg = e.data;\n    var datatype = msg.constructor;\n    // FIXME: msg is String until binary is supported.\n    // Once that happens, this will have to be smarter.\n    if (datatype === String) {\n      var ab = util.binaryStringToArrayBuffer(msg);\n      msg = util.unpack(ab);\n      self._handleMessage(msg);\n    }\n  };\n};\n\n// Handles an incoming message.\nReliable.prototype._handleMessage = function(msg) {\n  var id = msg[1];\n  var idata = this._incoming[id];\n  var odata = this._outgoing[id];\n  var data;\n  switch (msg[0]) {\n    // No chunking was done.\n    case 'no':\n      var message = id;\n      if (!!message) {\n        this.onmessage(util.unpack(message));\n      }\n      break;\n    // Reached the end of the message.\n    case 'end':\n      data = idata;\n\n      // In case end comes first.\n      this._received[id] = msg[2];\n\n      if (!data) {\n        break;\n      }\n\n      this._ack(id);\n      break;\n    case 'ack':\n      data = odata;\n      if (!!data) {\n        var ack = msg[2];\n        // Take the larger ACK, for out of order messages.\n        data.ack = Math.max(ack, data.ack);\n\n        // Clean up when all chunks are ACKed.\n        if (data.ack >= data.chunks.length) {\n          util.log('Time: ', new Date() - data.timer);\n          delete this._outgoing[id];\n        } else {\n          this._processAcks();\n        }\n      }\n      // If !data, just ignore.\n      break;\n    // Received a chunk of data.\n    case 'chunk':\n      // Create a new entry if none exists.\n      data = idata;\n      if (!data) {\n        var end = this._received[id];\n        if (end === true) {\n          break;\n        }\n        data = {\n          ack: ['ack', id, 0],\n          chunks: []\n        };\n        this._incoming[id] = data;\n      }\n\n      var n = msg[2];\n      var chunk = msg[3];\n      data.chunks[n] = new Uint8Array(chunk);\n\n      // If we get the chunk we're looking for, ACK for next missing.\n      // Otherwise, ACK the same N again.\n      if (n === data.ack[2]) {\n        this._calculateNextAck(id);\n      }\n      this._ack(id);\n      break;\n    default:\n      // Shouldn't happen, but would make sense for message to just go\n      // through as is.\n      this._handleSend(msg);\n      break;\n  }\n};\n\n// Chunks BL into smaller messages.\nReliable.prototype._chunk = function(bl) {\n  var chunks = [];\n  var size = bl.size;\n  var start = 0;\n  while (start < size) {\n    var end = Math.min(size, start + this._mtu);\n    var b = bl.slice(start, end);\n    var chunk = {\n      payload: b\n    }\n    chunks.push(chunk);\n    start = end;\n  }\n  util.log('Created', chunks.length, 'chunks.');\n  return chunks;\n};\n\n// Sends ACK N, expecting Nth blob chunk for message ID.\nReliable.prototype._ack = function(id) {\n  var ack = this._incoming[id].ack;\n\n  // if ack is the end value, then call _complete.\n  if (this._received[id] === ack[2]) {\n    this._complete(id);\n    this._received[id] = true;\n  }\n\n  this._handleSend(ack);\n};\n\n// Calculates the next ACK number, given chunks.\nReliable.prototype._calculateNextAck = function(id) {\n  var data = this._incoming[id];\n  var chunks = data.chunks;\n  for (var i = 0, ii = chunks.length; i < ii; i += 1) {\n    // This chunk is missing!!! Better ACK for it.\n    if (chunks[i] === undefined) {\n      data.ack[2] = i;\n      return;\n    }\n  }\n  data.ack[2] = chunks.length;\n};\n\n// Sends the next window of chunks.\nReliable.prototype._sendWindowedChunks = function(id) {\n  util.log('sendWindowedChunks for: ', id);\n  var data = this._outgoing[id];\n  var ch = data.chunks;\n  var chunks = [];\n  var limit = Math.min(data.ack + this._window, ch.length);\n  for (var i = data.ack; i < limit; i += 1) {\n    if (!ch[i].sent || i === data.ack) {\n      ch[i].sent = true;\n      chunks.push(['chunk', id, i, ch[i].payload]);\n    }\n  }\n  if (data.ack + this._window >= ch.length) {\n    chunks.push(['end', id, ch.length])\n  }\n  chunks._multiple = true;\n  this._handleSend(chunks);\n};\n\n// Puts together a message from chunks.\nReliable.prototype._complete = function(id) {\n  util.log('Completed called for', id);\n  var self = this;\n  var chunks = this._incoming[id].chunks;\n  var bl = new Blob(chunks);\n  util.blobToArrayBuffer(bl, function(ab) {\n    self.onmessage(util.unpack(ab));\n  });\n  delete this._incoming[id];\n};\n\n// Ups bandwidth limit on SDP. Meant to be called during offer/answer.\nReliable.higherBandwidthSDP = function(sdp) {\n  // AS stands for Application-Specific Maximum.\n  // Bandwidth number is in kilobits / sec.\n  // See RFC for more info: http://www.ietf.org/rfc/rfc2327.txt\n\n  // Chrome 31+ doesn't want us munging the SDP, so we'll let them have their\n  // way.\n  var version = navigator.appVersion.match(/Chrome\\/(.*?) /);\n  if (version) {\n    version = parseInt(version[1].split('.').shift());\n    if (version < 31) {\n      var parts = sdp.split('b=AS:30');\n      var replace = 'b=AS:102400'; // 100 Mbps\n      if (parts.length > 1) {\n        return parts[0] + replace + parts[1];\n      }\n    }\n  }\n\n  return sdp;\n};\n\n// Overwritten, typically.\nReliable.prototype.onmessage = function(msg) {};\n\nmodule.exports.Reliable = Reliable;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/reliable/lib/reliable.js\n// module id = 15\n// module chunks = 0","var BinaryPack = require('js-binarypack');\n\nvar util = {\n  debug: false,\n  \n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n  \n  log: function () {\n    if (util.debug) {\n      var copy = [];\n      for (var i = 0; i < arguments.length; i++) {\n        copy[i] = arguments[i];\n      }\n      copy.unshift('Reliable: ');\n      console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\t\t\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(this)),\n  \n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  }\n};\n\nmodule.exports = util;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/reliable/lib/util.js\n// module id = 16\n// module chunks = 0","var util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\nvar Reliable = require('reliable');\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nfunction DataConnection(peer, provider, options) {\n  if (!(this instanceof DataConnection)) return new DataConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({\n    serialization: 'binary',\n    reliable: false\n  }, options);\n\n  // Connection is not open yet.\n  this.open = false;\n  this.type = 'data';\n  this.peer = peer;\n  this.provider = provider;\n\n  this.id = this.options.connectionId || DataConnection._idPrefix + util.randomToken();\n\n  this.label = this.options.label || this.id;\n  this.metadata = this.options.metadata;\n  this.serialization = this.options.serialization;\n  this.reliable = this.options.reliable;\n\n  // Data channel buffering.\n  this._buffer = [];\n  this._buffering = false;\n  this.bufferSize = 0;\n\n  // For storing large data.\n  this._chunkedData = {};\n\n  if (this.options._payload) {\n    this._peerBrowser = this.options._payload.browser;\n  }\n\n  util.log(\"startConnection from DataConnection\");\n  Negotiator.startConnection(\n    this,\n    this.options._payload || {\n      originator: true\n    }\n  );\n}\n\nutil.inherits(DataConnection, EventEmitter);\n\nDataConnection._idPrefix = 'dc_';\n\n/** Called by the Negotiator when the DataChannel is ready. */\nDataConnection.prototype.initialize = function(dc) {\n  this._dc = this.dataChannel = dc;\n  this._configureDataChannel();\n}\n\nDataConnection.prototype._configureDataChannel = function() {\n  var self = this;\n  if (util.supports.sctp) {\n    this._dc.binaryType = 'arraybuffer';\n  }\n  this._dc.onopen = function() {\n    util.log('Data channel connection success');\n    self.open = true;\n    self.emit('open');\n  }\n\n  // Use the Reliable shim for non Firefox browsers\n  if (!util.supports.sctp && this.reliable) {\n    this._reliable = new Reliable(this._dc, util.debug);\n  }\n\n  if (this._reliable) {\n    this._reliable.onmessage = function(msg) {\n      self.emit('data', msg);\n    };\n  } else {\n    this._dc.onmessage = function(e) {\n      self._handleDataMessage(e);\n    };\n  }\n  this._dc.onclose = function(e) {\n    util.log('DataChannel closed for:', self.peer);\n    self.close();\n  };\n}\n\n// Handles a DataChannel message.\nDataConnection.prototype._handleDataMessage = function(e) {\n  var self = this;\n  var data = e.data;\n  var datatype = data.constructor;\n  if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    if (datatype === Blob) {\n      // Datatype should never be blob\n      util.blobToArrayBuffer(data, function(ab) {\n        data = util.unpack(ab);\n        self.emit('data', data);\n      });\n      return;\n    } else if (datatype === ArrayBuffer) {\n      data = util.unpack(data);\n    } else if (datatype === String) {\n      // String fallback for binary data for browsers that don't support binary yet\n      var ab = util.binaryStringToArrayBuffer(data);\n      data = util.unpack(ab);\n    }\n  } else if (this.serialization === 'json') {\n    data = JSON.parse(data);\n  }\n\n  // Check if we've chunked--if so, piece things back together.\n  // We're guaranteed that this isn't 0.\n  if (data.__peerData) {\n    var id = data.__peerData;\n    var chunkInfo = this._chunkedData[id] || {data: [], count: 0, total: data.total};\n\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count += 1;\n\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n\n      // We've received all the chunks--time to construct the complete data.\n      data = new Blob(chunkInfo.data);\n      this._handleDataMessage({data: data});\n    }\n\n    this._chunkedData[id] = chunkInfo;\n    return;\n  }\n\n  this.emit('data', data);\n}\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nDataConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close');\n}\n\n/** Allows user to send data. */\nDataConnection.prototype.send = function(data, chunked) {\n  if (!this.open) {\n    this.emit('error', new Error('Connection is not open. You should listen for the `open` event before sending messages.'));\n    return;\n  }\n  if (this._reliable) {\n    // Note: reliable shim sending will make it so that you cannot customize\n    // serialization.\n    this._reliable.send(data);\n    return;\n  }\n  var self = this;\n  if (this.serialization === 'json') {\n    this._bufferedSend(JSON.stringify(data));\n  } else if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    var blob = util.pack(data);\n\n    // For Chrome-Firefox interoperability, we need to make Firefox \"chunk\"\n    // the data it sends out.\n    var needsChunking = util.chunkedBrowsers[this._peerBrowser] || util.chunkedBrowsers[util.browser];\n    if (needsChunking && !chunked && blob.size > util.chunkedMTU) {\n      this._sendChunks(blob);\n      return;\n    }\n\n    // DataChannel currently only supports strings.\n    if (!util.supports.sctp) {\n      util.blobToBinaryString(blob, function(str) {\n        self._bufferedSend(str);\n      });\n    } else if (!util.supports.binaryBlob) {\n      // We only do this if we really need to (e.g. blobs are not supported),\n      // because this conversion is costly.\n      util.blobToArrayBuffer(blob, function(ab) {\n        self._bufferedSend(ab);\n      });\n    } else {\n      this._bufferedSend(blob);\n    }\n  } else {\n    this._bufferedSend(data);\n  }\n}\n\nDataConnection.prototype._bufferedSend = function(msg) {\n  if (this._buffering || !this._trySend(msg)) {\n    this._buffer.push(msg);\n    this.bufferSize = this._buffer.length;\n  }\n}\n\n// Returns true if the send succeeds.\nDataConnection.prototype._trySend = function(msg) {\n  try {\n    var data;\n\n    if ((window.webrtcDetectedBrowser === 'IE' || window.webrtcDetectedBrowser === 'safari') && msg instanceof ArrayBuffer) {\n      data = String.fromCharCode.apply(null, new Uint8Array(msg));\n    } else {     \n      data = msg;\n    }\n\n    this._dc.send(data);\n  } catch (e) {\n    this._buffering = true;\n\n    var self = this;\n    setTimeout(function() {\n      // Try again.\n      self._buffering = false;\n      self._tryBuffer();\n    }, 100);\n    return false;\n  }\n  return true;\n}\n\nDataConnection.prototype._tryBuffer = function() {\n  if (this._buffer.length === 0) {\n    return;\n  }\n\n  var msg = this._buffer[0];\n\n  if (this._trySend(msg)) {\n    this._buffer.shift();\n    this.bufferSize = this._buffer.length;\n    this._tryBuffer();\n  }\n}\n\nDataConnection.prototype._sendChunks = function(blob) {\n  var blobs = util.chunk(blob);\n  for (var i = 0, ii = blobs.length; i < ii; i += 1) {\n    var blob = blobs[i];\n    this.send(blob, true);\n  }\n}\n\nDataConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      this._peerBrowser = payload.browser;\n\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nmodule.exports = DataConnection;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/dataconnection.js\n// module id = 17\n// module chunks = 0","var util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nfunction MediaConnection(peer, provider, options) {\n  if (!(this instanceof MediaConnection)) return new MediaConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({}, options);\n\n  this.open = false;\n  this.type = 'media';\n  this.peer = peer;\n  this.provider = provider;\n  this.metadata = this.options.metadata;\n  this.localStream = this.options._stream;\n\n  this.id = this.options.connectionId || MediaConnection._idPrefix + util.randomToken();\n  util.log(\"startConnection from MediaConnection\");\n  if (this.localStream) {\n    Negotiator.startConnection(\n      this,\n      {_stream: this.localStream, originator: true}\n    );\n  }\n};\n\nutil.inherits(MediaConnection, EventEmitter);\n\nMediaConnection._idPrefix = 'mc_';\n\nMediaConnection.prototype.addStream = function(remoteStream) {\n  util.log('Receiving stream', remoteStream);\n\n  this.remoteStream = remoteStream;\n  this.emit('stream', remoteStream); // Should we call this `open`?\n\n};\n\nMediaConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      this.open = true;\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nMediaConnection.prototype.answer = function(stream) {\n  if (this.localStream) {\n    util.warn('Local stream already exists on this MediaConnection. Are you answering a call twice?');\n    return;\n  }\n\n  this.options._payload._stream = stream;\n\n  util.log(\"startConnection from answer step\");\n  this.localStream = stream;\n  Negotiator.startConnection(\n    this,\n    this.options._payload\n  )\n  // Retrieve lost messages stored because PeerConnection not set up.\n  var messages = this.provider._getMessages(this.id);\n  for (var i = 0, ii = messages.length; i < ii; i += 1) {\n    this.handleMessage(messages[i]);\n  }\n  this.open = true;\n};\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nMediaConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close')\n};\n\nmodule.exports = MediaConnection;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/mediaconnection.js\n// module id = 18\n// module chunks = 0","var util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Socket = require('./socket');\nvar MediaConnection = require('./mediaconnection');\nvar DataConnection = require('./dataconnection');\n\n/**\n * A peer who can initiate connections with other peers.\n */\nfunction Peer(id, options) {\n  if (!(this instanceof Peer)) return new Peer(id, options);\n  EventEmitter.call(this);\n\n  // Deal with overloading\n  if (id && id.constructor == Object) {\n    options = id;\n    id = undefined;\n  } else if (id) {\n    // Ensure id is a string\n    id = id.toString();\n  }\n  //\n\n  // Configurize options\n  options = util.extend({\n    debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n    host: util.CLOUD_HOST,\n    port: util.CLOUD_PORT,\n    key: 'peerjs',\n    path: '/',\n    token: util.randomToken(),\n    config: util.defaultConfig\n  }, options);\n  this.options = options;\n\n  // SkyWay Original Code\n  if(options.turn === undefined){\n      options.turn = true;\n  }\n\n  // Detect relative URL host.\n  if (options.host === '/') {\n    options.host = window.location.hostname;\n  }\n\n  // Set path correctly.\n  if (options.path[0] !== '/') {\n    options.path = '/' + options.path;\n  }\n  if (options.path[options.path.length - 1] !== '/') {\n    options.path += '/';\n  }\n\n  // Set whether we use SSL to same as current host unless hosted on skyway\n  if (options.host === util.CLOUD_HOST) {\n    options.secure = true;\n  } else if (options.secure === undefined) {\n    options.secure = util.isSecure();\n  }\n  // Set whether the server supports WS keepalives\n  if (options.host === util.CLOUD_HOST) {\n      util.supportsKeepAlive = true;\n  } else if (options.keepalive) {\n      util.supportsKeepAlive = options.keepalive;\n  }\n  // Set a custom log function if present\n  if (options.logFunction) {\n    util.setLogFunction(options.logFunction);\n  }\n  util.setLogLevel(options.debug);\n  //\n\n  // Sanity checks\n  // Ensure WebRTC supported\n  if (!util.supports.audioVideo && !util.supports.data ) {\n    this._delayedAbort('browser-incompatible', 'The current browser does not support WebRTC');\n    return;\n  }\n  // Ensure alphanumeric id\n  if (!util.validateId(id)) {\n    this._delayedAbort('invalid-id', 'ID \"' + id + '\" is invalid');\n    return;\n  }\n  // Ensure valid key\n  if (!util.validateKey(options.key)) {\n    this._delayedAbort('invalid-key', 'API KEY \"' + options.key + '\" is invalid');\n    return;\n  }\n  // Ensure not using unsecure cloud server on SSL page\n  if (options.secure && options.host === '0.peerjs.com') {\n    this._delayedAbort('ssl-unavailable',\n      'The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.');\n    return;\n  }\n  //\n\n  // States.\n  this.destroyed = false; // Connections have been killed\n  this.disconnected = false; // Connection to PeerServer killed but P2P connections still active\n  this.open = false; // Sockets and such are not yet open.\n  //\n\n  // References\n  this.connections = {}; // DataConnections for this peer.\n  this._lostMessages = {}; // src => [list of messages]\n  //\n\n  // Start the server connection\n  // SkyWay Original Code\n  this._initializeServerConnection();\n  if (id) {\n    this._retrieveId(id);\n  } else {\n    this._retrieveId();\n  }\n  //\n}\n\nutil.inherits(Peer, EventEmitter);\n\n// Initialize the 'socket' (which is actually a mix of XHR streaming and\n// websockets.)\nPeer.prototype._initializeServerConnection = function() {\n  var self = this;\n  this.socket = new Socket(this.options.secure, this.options.host, this.options.port, this.options.path, this.options.key);\n  this.socket.on('message', function(data) {\n    self._handleMessage(data);\n  });\n  this.socket.on('error', function(error) {\n    self._abort('socket-error', error);\n  });\n  this.socket.on('disconnected', function() {\n    // If we haven't explicitly disconnected, emit error and disconnect.\n    if (!self.disconnected) {\n      self.emitError('network', 'Lost connection to server.');\n      self.disconnect();\n    }\n  });\n  this.socket.on('close', function() {\n    // If we haven't explicitly disconnected, emit error.\n    if (!self.disconnected) {\n      self._abort('socket-closed', 'Underlying socket is already closed.');\n    }\n  });\n   // Close sockets before unloading window\n   // Necessary as sometimes the brower doesn't close ws/xhr property\n   // especially for FF\n   window.onbeforeunload = function(ev) {\n     self.destroy();\n   }\n};\n\n/** Get a unique ID from the server via XHR. */\n// SkyWay Original Code\nPeer.prototype._retrieveId = function(id) {\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n  var url = protocol + this.options.host + ':' + this.options.port +\n    this.options.path + this.options.key + '/id';\n  if(id !== undefined){\n    var queryString = '?ts=' + new Date().getTime() + '' + Math.random() + '&id=' + id;\n  }else{\n    var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n  }\n\n  url += queryString;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    util.error('Error retrieving ID', e);\n    var pathError = '';\n    if (self.options.path === '/' && self.options.host !== util.CLOUD_HOST) {\n      pathError = ' If you passed in a `path` to your self-hosted PeerServer, ' +\n        'you\\'ll also need to pass in that same path when creating a new ' +\n        'Peer.';\n    }\n    self._abort('server-error', 'Could not get an ID from the server.' + pathError);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status !== 200) {\n      http.onerror();\n      return;\n    }\n    self._initialize(http.responseText);\n  };\n  http.send(null);\n};\n\n/** Initialize a connection with the server. */\nPeer.prototype._initialize = function(serverid) {\n  // SkyWay Original Code\n  try {\n    _response = JSON.parse(serverid);\n    if(typeof _response === 'object'){\n        this.id = _response.id;\n        this.credential = _response.credential;\n    }else{\n        this.id = serverid;\n    }\n  } catch (e){\n    this.id = serverid;\n  }\n\n  // SkyWay Original Code\n  if(this.options.turn === true){\n    if(this.credential){\n      this.options.config.iceServers.push({\n        urls: 'turn:' + util.TURN_HOST + ':' + util.TURN_PORT + '?transport=tcp',\n        url: 'turn:' + util.TURN_HOST + ':' + util.TURN_PORT + '?transport=tcp',\n        username: this.options.key + '$' + this.id,\n        credential: this.credential\n      });\n      this.options.config.iceServers.push({\n        urls: 'turn:' + util.TURN_HOST + ':' + util.TURN_PORT + '?transport=udp',\n        url: 'turn:' + util.TURN_HOST + ':' + util.TURN_PORT + '?transport=udp',\n        username: this.options.key + '$' + this.id,\n        credential: this.credential\n      });\n      this.options.config.iceTransports = 'all';\n    }\n  }\n\n  if(this.credential && this.options.turn == true){\n    util.log('SkyWay TURN Server is available');\n  }else{\n    util.log('SkyWay TURN Server is unavailable');\n  }\n\n  this.socket.start(this.id, this.options.token);\n};\n\n/** Handles messages from the server. */\nPeer.prototype._handleMessage = function(message) {\n  var type = message.type;\n  var payload = message.payload;\n  var peer = message.src;\n  var connection;\n\n  switch (type) {\n    case 'OPEN': // The connection to the server is open.\n      this.emit('open', this.id);\n      this.open = true;\n      break;\n    case 'ERROR': // Server error.\n      this._abort('server-error', payload.msg);\n      break;\n    case 'ID-TAKEN': // The selected ID is taken.\n      this._abort('unavailable-id', 'ID `' + this.id + '` is taken');\n      break;\n    case 'INVALID-KEY': // The given API key cannot be found.\n      this._abort('invalid-key', 'API KEY \"' + this.options.key + '\" is invalid');\n      break;\n    case 'PING':\n      this.socket.sendPong();\n      break;\n    case 'LEAVE': // Another peer has closed its connection to this peer.\n      util.log('Received leave message from', peer);\n      this._cleanupPeer(peer);\n      break;\n\n    case 'EXPIRE': // The offer sent to a peer has expired without response.\n      this.emitError('peer-unavailable', 'Could not connect to peer ' + peer);\n      break;\n    case 'OFFER': // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n      var connectionId = payload.connectionId;\n      connection = this.getConnection(peer, connectionId);\n\n      if (connection) {\n        util.warn('Offer received for existing Connection ID:', connectionId);\n        //connection.handleMessage(message);\n      } else {\n        // Create a new connection.\n        if (payload.type === 'media') {\n          connection = new MediaConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          util.log(\"MediaConnection created in OFFER\");\n          this._addConnection(peer, connection);\n          this.emit('call', connection);\n        } else if (payload.type === 'data') {\n          connection = new DataConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          this._addConnection(peer, connection);\n          this.emit('connection', connection);\n        } else {\n          util.warn('Received malformed connection type:', payload.type);\n          return;\n        }\n        // Find messages.\n        var messages = this._getMessages(connectionId);\n        for (var i = 0, ii = messages.length; i < ii; i += 1) {\n          connection.handleMessage(messages[i]);\n        }\n      }\n      break;\n    default:\n      if (!payload) {\n        util.warn('You received a malformed message from ' + peer + ' of type ' + type);\n        return;\n      }\n\n      var id = payload.connectionId;\n      connection = this.getConnection(peer, id);\n\n      if (connection && connection.pc) {\n        // Pass it on.\n        connection.handleMessage(message);\n      } else if (id) {\n        // Store for possible later use\n        this._storeMessage(id, message);\n      } else {\n        util.warn('You received an unrecognized message:', message);\n      }\n      break;\n  }\n};\n\n/** Stores messages without a set up connection, to be claimed later. */\nPeer.prototype._storeMessage = function(connectionId, message) {\n  if (!this._lostMessages[connectionId]) {\n    this._lostMessages[connectionId] = [];\n  }\n  this._lostMessages[connectionId].push(message);\n};\n\n/** Retrieve messages from lost message store */\nPeer.prototype._getMessages = function(connectionId) {\n  var messages = this._lostMessages[connectionId];\n  if (messages) {\n    delete this._lostMessages[connectionId];\n    return messages;\n  } else {\n    return [];\n  }\n};\n\n/**\n * Returns a DataConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.connect = function(peer, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect, or call reconnect ' +\n      'on this peer if you believe its ID to still be available.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  var connection = new DataConnection(peer, this, options);\n  this._addConnection(peer, connection);\n  return connection;\n};\n\n/**\n * Returns a MediaConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.call = function(peer, stream, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  if (!stream) {\n    util.error('To call a peer, you must provide a stream from your browser\\'s `getUserMedia`.');\n    return;\n  }\n  options = options || {};\n  options._stream = stream;\n  var call = new MediaConnection(peer, this, options);\n  util.log(\"MediaConnection created in call method\");\n  this._addConnection(peer, call);\n  return call;\n};\n\n/** Add a data/media connection to this peer. */\nPeer.prototype._addConnection = function(peer, connection) {\n  if (!this.connections[peer]) {\n    this.connections[peer] = [];\n  }\n  this.connections[peer].push(connection);\n};\n\n/** Retrieve a data/media connection for this peer. */\nPeer.prototype.getConnection = function(peer, id) {\n  var connections = this.connections[peer];\n  if (!connections) {\n    return null;\n  }\n  for (var i = 0, ii = connections.length; i < ii; i++) {\n    if (connections[i].id === id) {\n      return connections[i];\n    }\n  }\n  return null;\n};\n\nPeer.prototype._delayedAbort = function(type, message) {\n  var self = this;\n  util.setZeroTimeout(function(){\n    self._abort(type, message);\n  });\n};\n\n/**\n * Destroys the Peer and emits an error message.\n * The Peer is not destroyed if it's in a disconnected state, in which case\n * it retains its disconnected state and its existing connections.\n */\nPeer.prototype._abort = function(type, message) {\n  util.error('Aborting!');\n  if (!this._lastServerId) {\n    this.destroy();\n  } else {\n    this.disconnect();\n  }\n  this.emitError(type, message);\n};\n\n/** Emits a typed error message. */\nPeer.prototype.emitError = function(type, err) {\n  util.error('Error:', err);\n  if (typeof err === 'string') {\n    err = new Error(err);\n  }\n  err.type = type;\n  this.emit('error', err);\n};\n\n/**\n * Destroys the Peer: closes all active connections as well as the connection\n *  to the server.\n * Warning: The peer can no longer create or accept connections after being\n *  destroyed.\n */\nPeer.prototype.destroy = function() {\n  if (!this.destroyed) {\n    this.destroyed = true;\n    this._cleanup();\n    this.disconnect();\n  }\n};\n\n\n/** Disconnects every connection on this peer. */\nPeer.prototype._cleanup = function() {\n  if (this.connections) {\n    var peers = Object.keys(this.connections);\n    for (var i = 0, ii = peers.length; i < ii; i++) {\n      this._cleanupPeer(peers[i]);\n    }\n  }\n  this.emit('close');\n};\n\n/** Closes all connections to this peer. */\nPeer.prototype._cleanupPeer = function(peer) {\n  var connections = this.connections[peer];\n  for (var j = 0, jj = connections.length; j < jj; j += 1) {\n    connections[j].close();\n  }\n};\n\n/**\n * Disconnects the Peer's connection to the PeerServer. Does not close any\n *  active connections.\n * Warning: The peer can no longer create or accept connections after being\n *  disconnected. It also cannot reconnect to the server.\n */\nPeer.prototype.disconnect = function() {\n  var self = this;\n  util.setZeroTimeout(function(){\n    if (!self.disconnected) {\n      self.disconnected = true;\n      self.open = false;\n      if (self.socket) {\n        self.socket.close();\n      }\n      self.emit('disconnected', self.id);\n      self._lastServerId = self.id;\n      self.id = null;\n    }\n  });\n};\n\n/** Attempts to reconnect with the same ID. */\nPeer.prototype.reconnect = function() {\n  if (this.disconnected && !this.destroyed) {\n    util.log('Attempting reconnection to server with ID ' + this._lastServerId);\n    this.disconnected = false;\n    this._initializeServerConnection();\n    this._initialize(this._lastServerId);\n  } else if (this.destroyed) {\n    throw new Error('This peer cannot reconnect to the server. It has already been destroyed.');\n  } else if (!this.disconnected && !this.open) {\n    // Do nothing. We're still connecting the first time.\n    util.error('In a hurry? We\\'re still trying to make the initial connection!');\n  } else {\n    throw new Error('Peer ' + this.id + ' cannot reconnect because it is not disconnected from the server!');\n  }\n};\n\n/**\n * Get a list of available peer IDs. If you're running your own server, you'll\n * want to set allow_discovery: true in the PeerServer options. If you're using\n * the cloud server, email team@peerjs.com to get the functionality enabled for\n * your key.\n */\nPeer.prototype.listAllPeers = function(cb) {\n  cb = cb || function() {};\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n\n  var url = protocol + this.options.host + ':' + this.options.port\n    + this.options.path + 'active/list/' + this.options.key;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    self._abort('server-error', 'Could not get peers from the server.');\n    cb([]);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status === 401) {\n      var helpfulError = '';\n      if (self.options.host !== util.CLOUD_HOST) {\n        helpfulError = 'It looks like you\\'re using the cloud server. You can email ' +\n          'team@peerjs.com to enable peer listing for your API key.';\n      } else {\n        helpfulError = 'You need to enable `allow_discovery` on your self-hosted ' +\n          'PeerServer to use this feature.';\n      }\n      cb([]);\n      throw new Error('It doesn\\'t look like you have permission to list peers IDs. ' + helpfulError);\n    } else if (http.status !== 200) {\n      cb([]);\n    } else {\n      cb(JSON.parse(http.responseText));\n    }\n  };\n  http.send(null);\n};\n\nmodule.exports = Peer;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/peer.js\n// module id = 19\n// module chunks = 0","var util = require('./util');\nvar EventEmitter = require('eventemitter3');\n\n/**\n * An abstraction on top of WebSockets and XHR streaming to provide fastest\n * possible connection for peers.\n */\nfunction Socket(secure, host, port, path, key) {\n  if (!(this instanceof Socket)) return new Socket(secure, host, port, path, key);\n\n  EventEmitter.call(this);\n\n  // Disconnected manually.\n  this.disconnected = false;\n  this._queue = [];\n\n  var httpProtocol = secure ? 'https://' : 'http://';\n  var wsProtocol = secure ? 'wss://' : 'ws://';\n  this._httpUrl = httpProtocol + host + ':' + port + path + key;\n  this._wsUrl = wsProtocol + host + ':' + port + path + 'peerjs?key=' + key;\n}\n\nutil.inherits(Socket, EventEmitter);\n\n\n/** Check in with ID or get one from server. */\nSocket.prototype.start = function(id, token) {\n  this.id = id;\n\n  this._httpUrl += '/' + id + '/' + token;\n  this._wsUrl += '&id=' + id + '&token=' + token;\n\n  this._startXhrStream();\n  this._startWebSocket();\n}\n\n\n/** Start up websocket communications. */\nSocket.prototype._startWebSocket = function(id) {\n  var self = this;\n\n  if (this._socket) {\n    return;\n  }\n\n  this._socket = new WebSocket(this._wsUrl);\n\n  this._socket.onmessage = function(event) {\n    try {\n      var data = JSON.parse(event.data);\n    } catch(e) {\n      util.log('Invalid server message', event.data);\n      return;\n    }\n    self.emit('message', data);\n  };\n\n  // Take care of the queue of connections if necessary and make sure Peer knows\n  // socket is open.\n  this._socket.onopen = function() {\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n      setTimeout(function(){\n        self._http.abort();\n        self._http = null;\n      }, 5000);\n    }\n    if (util.supportsKeepAlive) {\n      self._setWSTimeout();\n    }\n    self._sendQueuedMessages();\n    util.log('Socket open');\n  };\n\n  this._socket.onerror = function(err) {\n    util.error('WS error code '+err.code);\n  }\n\n  // Fall back to XHR if WS closes\n  this._socket.onclose = function(msg) {\n      util.error(\"WS closed with code \"+msg.code);\n      if(!self.disconnected) {\n        self._startXhrStream();\n      }\n  }\n}\n\n/** Start XHR streaming. */\nSocket.prototype._startXhrStream = function(n) {\n  try {\n    var self = this;\n    this._http = new XMLHttpRequest();\n    this._http._index = 1;\n    this._http._streamIndex = n || 0;\n    this._http.open('post', this._httpUrl + '/id?i=' + this._http._streamIndex, true);\n    this._http.onerror = function() {\n      // If we get an error, likely something went wrong.\n      // Stop streaming.\n      clearTimeout(self._timeout);\n      self.emit('disconnected');\n    }\n    this._http.onreadystatechange = function() {\n      if (this.readyState == 2 && this.old) {\n        this.old.abort();\n        delete this.old;\n      } else if (this.readyState > 2 && this.status === 200 && this.responseText) {\n        self._handleStream(this);\n      }\n    };\n    this._http.send(null);\n    this._setHTTPTimeout();\n  } catch(e) {\n    util.log('XMLHttpRequest not available; defaulting to WebSockets');\n  }\n}\n\n\n/** Handles onreadystatechange response as a stream. */\nSocket.prototype._handleStream = function(http) {\n  // 3 and 4 are loading/done state. All others are not relevant.\n  var messages = http.responseText.split('\\n');\n\n  // Check to see if anything needs to be processed on buffer.\n  if (http._buffer) {\n    while (http._buffer.length > 0) {\n      var index = http._buffer.shift();\n      var bufferedMessage = messages[index];\n      try {\n        bufferedMessage = JSON.parse(bufferedMessage);\n      } catch(e) {\n        http._buffer.shift(index);\n        break;\n      }\n      this.emit('message', bufferedMessage);\n    }\n  }\n\n  var message = messages[http._index];\n  if (message) {\n    http._index += 1;\n    // Buffering--this message is incomplete and we'll get to it next time.\n    // This checks if the httpResponse ended in a `\\n`, in which case the last\n    // element of messages should be the empty string.\n    if (http._index === messages.length) {\n      if (!http._buffer) {\n        http._buffer = [];\n      }\n      http._buffer.push(http._index - 1);\n    } else {\n      try {\n        message = JSON.parse(message);\n      } catch(e) {\n        util.log('Invalid server message', message);\n        return;\n      }\n      this.emit('message', message);\n    }\n  }\n}\n\nSocket.prototype._setHTTPTimeout = function() {\n  var self = this;\n  this._timeout = setTimeout(function() {\n    var old = self._http;\n    if (!self._wsOpen()) {\n      self._startXhrStream(old._streamIndex + 1);\n      self._http.old = old;\n    } else {\n      old.abort();\n    }\n  }, 25000);\n}\n\nSocket.prototype._setWSTimeout = function(){\n    var self = this;\n    this._wsTimeout = setTimeout(function(){\n        if(self._wsOpen()){\n            self._socket.close();\n            util.error('WS timed out');\n        }\n    }, 45000)\n}\n\n/** Is the websocket currently open? */\nSocket.prototype._wsOpen = function() {\n  return this._socket && this._socket.readyState == 1;\n}\n\n/** Send queued messages. */\nSocket.prototype._sendQueuedMessages = function() {\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    this.send(this._queue[i]);\n  }\n}\n\n/** Exposed send for DC & Peer. */\nSocket.prototype.send = function(data) {\n  if (this.disconnected) {\n    return;\n  }\n\n  // If we didn't get an ID yet, we can't yet send anything so we should queue\n  // up these messages.\n  if (!this.id) {\n    this._queue.push(data);\n    return;\n  }\n\n  if (!data.type) {\n    this.emit('error', 'Invalid message');\n    return;\n  }\n\n  var message = JSON.stringify(data);\n  if (this._wsOpen()) {\n    this._socket.send(message);\n  } else if(data.type !== 'PONG') {\n    var http = new XMLHttpRequest();\n    var url = this._httpUrl + '/' + data.type.toLowerCase();\n    http.open('post', url, true);\n    http.setRequestHeader('Content-Type', 'application/json');\n    http.send(message);\n  }\n}\n\nSocket.prototype.sendPong = function() {\n  if (this._wsOpen()) {\n    this.send({type:'PONG'});\n    if (this._wsTimeout) {\n      clearTimeout(this._wsTimeout);\n    }\n    this._setWSTimeout();\n  }\n}\n\nSocket.prototype.close = function() {\n  if (!this.disconnected) {\n    this.disconnected = true;\n    if(this._wsOpen()) {\n      this._socket.close();\n    }\n    if(this._http) {\n        this._http.abort();\n    }\n    clearTimeout(this._timeout);\n  }\n}\n\nmodule.exports = Socket;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/skyway-peerjs/lib/socket.js\n// module id = 20\n// module chunks = 0"],"sourceRoot":""}